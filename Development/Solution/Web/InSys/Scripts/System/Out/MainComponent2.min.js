"use strict";define(["app"],function(n){var r=function(n,t,i,r,u,f,e){t("BaseController",{$scope:n});var o=function(){n.Request("Session").then(function(f){var c,l,a,o,v,h,s,nt;n.UserRow(f);t("MenuController",{$scope:n});c=1;localStorage.setItem("menutypemo",c);const k=n.PersonaName;l=window.btoa(k);localStorage.setItem("us",l);n.vueLayout=null;n.chartCollections=[];const d=n.Session("Company");a=window.btoa(d);localStorage.setItem("cnv",a);n.AppTitle="InSys";n.IsSystem=!1;const g=f.GUID;localStorage.setItem("gu",g);n.AppTitle="InSys";n.IsSystem=parseFloat(n.Session("ID_UserGroup"))===1;n.DisplayPhoto=window.sessionStorage.DisplayPhoto==undefined?n.Session("ImageFile"):window.sessionStorage.DisplayPhoto;n.HasClass=!1;n.Announcements=[];n.Notifications=[];n.NotificationCnt=0;n.computeWidgetContainerHeight=function(t){var i=$("#appLayout"),r;i.length>0&&(r=window.innerHeight-i[0].offsetTop+(t==null?0:t),i.css("max-height",r+"px"),i.css("height",r+"px"),n.tmpWidget=angular.copy(n.widgetLayout))};n.Restart=function(){n.Confirm("Are you sure you want to restart the website?","Restart").then(function(){n.Request("RestartWebsite",{});setTimeout(function(){n.ToggleUser();window.sessionStorage.clear();setTimeout(function(){n.ActionUrl("LogOut","Account")},100)},5e3)})};n.Init=function(){n.GetAnnouncements();n.AppTitle=n.Session("Company");$(".bookmark-panel").addClass("toggle-bookmark");$(".star").addClass("toggle-star");setTimeout(function(){$(".bookmark-panel").removeClass("toggle-bookmark");$(".star").removeClass("toggle-star")},2e3);$(".side-menu").removeClass("toggle-sidemenu")};n.OpenCalendar=function(){n.Dialog({template:"FullCalendar.tmpl.html",controller:"fullCalendar",windowClass:"custom-calendar",size:"lg",data:{}})};n.computeWidgetContainerHeight=function(t){var i=$("#appLayout"),r;i.length>0&&(r=window.innerHeight-i[0].offsetTop+(t==null?0:t),i.css("max-height",r+"px"),i.css("height",r+"px"),n.tmpWidget=angular.copy(n.widgetLayout))};n.GetAnnouncements=function(){n.Request("getAnnouncements",{ID_ApplicationType:n.ActiveApplicationType,ID_Company:parseInt(n.Session("ID_Company"))}).then(function(t){n.Announcements=t;setTimeout(function(){n.computeWidgetContainerHeight()},1e3)})};n.Init();n.openDashHead=function(){n.IsOpenAnnouncement=!1;i.current.name!="Dashboard"&&$("#crslAnnouncement").carousel("cycle");n.Announcements.length>0?($(".dashboard-2").toggleClass("open"),n.HasClass=!0,n.IsOpenAnnouncement=!0,$(".dashboard-2").hasClass("open")?($(".dashboard-2-title").text("Announcements"),n.IsOpenAnnouncement=!0):($(".dashboard-2-title").text("Dashboard"),n.IsOpenAnnouncement=!1)):($(".dashboard-2").removeClass("open"),n.HasClass=!1,n.IsOpenAnnouncement=!1);setTimeout(function(){n.computeWidgetContainerHeight()},300)};n.Publish=function(t){t||n.ToggleUser();var i=vcl.Random.S4();n.OverlayMessage("Publishing Menu");n.Request("Publish",{RequestID:i,ID_Menu:t||null}).then(function(){n.ShowOverlay();n.CheckPublishStatus(i)}).fail(function(t){console.log(t);n.Toast(t.data.Message,"Publish Website","warning")})};n.CheckPublishStatus=function(t){n.Request("PublishStatus",{RequestID:t}).then(function(i){i.Status===0?(n.OverlayMessage(i.Message),n.Task(null,1e3).then(function(){n.CheckPublishStatus(t)})):(n.HideOverlay(),n.Toast("Publish Successful.","Publish Website","success"),window.location.reload())})};n.LogOut=function(){n.ToggleUser();window.sessionStorage.clear();localStorage.removeItem("ipadd");setTimeout(function(){n.ActionUrl("LogOut","Account")},100)};n.OnBlur=function(){setTimeout(function(){$(".header-user").removeClass("toggle-user");$(".user-toggle-container").removeClass("toggle-user")},200)};n.ToggleUser=function(){$(".header-user").toggleClass("toggle-user");$(".user-toggle-container").toggleClass("toggle-user");n.ToggleUploadLeave()};n.ToggleSideMenu=function(){$(".side-menu").toggleClass("toggle-sidemenu");$(".untoggled-actions").toggleClass("toggle-actions");$(".bookmark-panel").removeClass("toggle-bookmark");$(".star").removeClass("toggle-star");i.current.name=="List"&&setTimeout(function(){var n=$(".table-footer").width()-$(".module-header").width()+10;$(".paging").css("right",n)},100);i.current.name=="Dashboard"?setTimeout(function(){$(".tab-content").find("table").each(function(){var t=$(this).attr("id").split("_")[$(this).attr("id").split("_").length-1],e=$(".expandor_"+t).attr("rc"),n=[],i=$("#tbl_head_"+t),r=$("#tbl_body_"+t),o=i.parent()[0].clientWidth,u=0,f;for(r.children().children().each(function(t){for(var r,u=$(this)[0].children,i=0;i<u.length;i++)r=u[i].textContent.length*10+20,e==0&&(r=20),t==0?n.push(r):n[i]<r&&(n[i]=r)}),r.children().children().each(function(){for(var i=$(this)[0].children,t=0;t<i.length;t++)i[t].style.width=n[t]+"px"}),f=0;f<n.length;f++)u+=n[f];i.children().children().children().each(function(t){$(this).css("width",n[t])});o>u?(i[0].style.width="100%",r[0].style.width="100%"):(i.css("width",u),r.css("width",u));$("#div_body_"+t).on("scroll",function(){$("#div_head_"+t).scrollLeft($(this)[0].scrollLeft)})});n.widgetLayout.length>0&&angular.forEach(n.widgetLayout,function(t){var i=Enumerable.From(n.widgetLayout).Where(function(n){return parseInt(n.i)==parseInt(t.i)}).ToArray()[0],r,u,f;i.x=t.x;i.y=t.y;i.w=t.w;i.h=t.h;i.IsRemove=!1;i.showType=!0;$("#containerChart_"+i.i).length>0?(r=265+(t.h-8)*40,$("#containerChart_"+i.i)[0].style.height=r+"px",u=i.i,f=Enumerable.From(n.chartCollections).Where(function(n){return n.options.cid==u}).ToArray()[0],setTimeout(function(){f.render()},500)):$("#sl_"+i.i).length>0&&($("#sl_"+i.i).find(".menu-abbr")[0].style.textOverflow="ellipsis",$("#sl_"+i.i).find(".menu-abbr")[0].style.overflow="hidden",$("#sl_"+i.i).find(".menu-abbr")[0].style.fontSize=60+(t.h-4)*35+"px")})},500):setTimeout(function(){var n=$(".MenuTable");n.length>0&&$(".MenuTable").each(function(){var n=parseInt($(".main-content").css("width").replace("px",""))-5,t=$(this);parseInt(t.css("maxWidth").replace("px",""))<n&&(t.css("maxWidth",n),t.css("minWidth",n),t.css("width",n))})},500)};n.ToggleBookmark=function(){$(".bookmark-panel").toggleClass("toggle-bookmark");$(".star").toggleClass("toggle-star")};n.ToggleUpload=function(){$(".user-toggle-container").hasClass("toggle-user")==!0&&$(".upload-button").addClass("upload-toggle")};n.ToggleUploadLeave=function(){$(".upload-button").removeClass("upload-toggle")};n.SearchClear=function(){$("#auto_searchMain_value").val("");var n=jQuery.Event("keydown");n.which=8;$("#auto_searchMain_value").trigger(n)};n.menuSelect=function(t){var r="";if(t.ReportFile==""||t.ReportFile==null)switch(parseInt(t.ID_MenuType)){case 3:n.Alert("text view here, under construction");break;default:r="List"}else r="Report";i.go(r,{Name:t.Name.replace(/ /g,"-"),r:LZString.compressToEncodedURIComponent(t.ID.toString())})};n.GoToDashboard=function(){var t=n.ActiveApplicationType==1?"Dashboard":"IONS";i.go(t)};n.GotoHangFire=function(){window.location="/HangFire"};n.PublishWidget=function(){n.ToggleUser();n.Request("PublishWidget",{}).then(function(){n.Toast("Publish Successful.","Publish Widget","success");window.location.reload()}).fail(function(t){console.log(t);n.Toast(t.data.Message,"Publish Widget","warning")})};n.toggleFav=function(t){if(t.HasFav=t.HasFav?!1:!0,t.HasFav){var i={ID:0,ID_ApplicationType:parseInt(n.ActiveApplicationType),ID_Menu:t.ID,Menu:t.Name,SeqNo:n.UserFav.length+1,ID_User:parseInt(n.Session("ID_User"))};vcl.Array.Remove(n.UserFav,function(n){return n.ID_Menu===t.ID});n.Request("AddUserFav",i).then(function(){n.UserFav.push(i)})}else n.Request("RemoveUserFav",{ID_User:parseInt(n.Session("ID_User")),ID_Menu:t.ID}).then(function(){vcl.Array.Remove(n.UserFav,function(n){return n.ID_Menu===t.ID})})};n.FavRemove=function(t){n.Request("RemoveUserFav",{ID_User:parseInt(n.Session("ID_User")),ID_Menu:t.ID_Menu}).then(function(){vcl.Array.Remove(n.UserFav,function(n){return n.ID_Menu===t.ID_Menu});n.UpdateMenuItem(t.ID_Menu,"HasFav",!1)})};n.FavFilter=function(t){return t.ID_ApplicationType===parseInt(n.ActiveApplicationType)};n.FavMenuSelect=function(t){var i=n.GetMenuItem(t.ID_Menu);n.menuSelect(i);$(".bookmark-panel").removeClass("toggle-bookmark");$(".star").removeClass("toggle-star")};n.Contents=function(){n.ToggleUser();i.go("Contents")};n.GoToThemes=function(){n.ToggleUser();i.go("Themes")};o=localStorage.getItem("ex");v=window.atob(o);o!==undefined&&o!==""&&o!==null&&o!=="na"&&o!=="bnVsbA=="&&n.Request("SetUserOnline",{GUID:v}).then(function(){localStorage.setItem("ex","na")});n.UploadDP=function(){$(".upload-button").removeClass("upload-toggle");n.UploadFile("UploadImage",null,!1,"image/*").then(function(t){n.Request("UpdateWebImage",{Column:"ImageFile",Value:t.GUID,ID:n.Session("ID_User"),ID_Employee:n.Session("ID_Employee")}).then(function(){n.Session("ImageFile",t.GUID);n.DisplayPhoto=t.GUID;window.sessionStorage.DisplayPhoto=t.GUID;n.Toast("Display Photo has been Updated")});$(".upload-button").removeClass("upload-toggle")}).fail(function(t){$(".upload-button").removeClass("upload-toggle");n.Toast(t,document.title,"warning")})};n.menuContext=[];n.tmp=function(){n.Dialog({template:"tmp.tmpl.html",controller:"tmp",windowClass:"tmp-dlg",size:"lg",data:{}})};var y=$(".bookmark-panel")[0].offsetTop,p=$(".bookmark-panel")[0].clientHeight,w=$(".right-box")[0].offsetTop,b=$(".right-box")[0].clientHeight;$(".bookmark-list").css("maxHeight",p-36-y);$(".bookmark-list").css("minHeight",p-36-y);$(".right-box-body").css("maxHeight",b-36-w);$(".right-box-body").css("minHeight",b-36-w);n.selectedMenu="";n.openHelper=function(){i.go("Helper",{reload:!0});n.ToggleUser()};n.Request("fetchInitNotifications",{appType:n.ActiveApplicationType}).then(function(t){t.error==undefined?(n.Notifications=t.data,n.NotificationCnt=t.cnt):n.Toast(t.error,"FetchInitNotifications","warning")});n.FormatCalendarDate=function(n,t){var i=new Date(n);return t=="month"?i=["January","February","March","April","May","June","July","August","September","October","November","December"][i.getUTCMonth()].substr(0,3):t=="day"&&(i=i.getUTCDate()),i};$(".dashboard-2").hover(function(){$("#crslAnnouncement").carousel("pause")},function(){$("#crslAnnouncement").carousel("cycle")});n.currentState=i.current.name;u.$on("$stateChangeStart",function(t,i){n.currentState=i.name});$(document).ready(function(){$("#noti_Button").click(function(){return $("#notifications").fadeToggle("fast","linear"),!1});$(document).click(function(){$("#notifications").hide()});$("#notifications").click(function(){return!1})});h=!0;$("#notifications_container").scroll(function(){if(h&&$("#notification_spinner").length==0&&$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight){$("#notifications_container").append('<div id="notification_spinner" style="padding: 5px;font-size: 20px;text-align: center;"><i class="fa fa-spinner fa-spin"><\/i><\/div>');var i=Enumerable.From(n.Notifications).Select(function(n){return n.ID}).ToArray(),r=n.ID_ApplicationType,t=$(this);n.Request("fetchOldNotifications",{ids:i,appType:r},"Action",!0).then(function(i){i.error==undefined?i.length>0&&(Enumerable.From(i).ForEach(function(t){n.Notifications.push(t)}),n.NotificationCnt=n.NotificationCnt+Enumerable.From(i).Where(function(n){return n.IsView==0}).ToArray().length):n.Toast(i.error,"FetchOldNotifications","warning");t.scrollTop(t[0].scrollHeight-(t.innerHeight()+50));$("#notification_spinner").remove();h=!1;setTimeout(function(){h=!0},5e3)})}});n.setNotificationTime=function(n){function e(n,t){var i=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes()),r=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes());return Math.floor((r-i)/u)}function o(n){var t=n.getHours(),i=n.getMinutes(),u=t>=12?"pm":"am",r;return t=t%12,t=t?t:12,i=i<10?"0"+i:i,r=t+":"+i+" "+u,n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear()+" "+r}var u=6e4,f=new Date,r=new Date(n),i=e(r,f),t=null;return i/60>=1?i/1440>=1?i/10080>=1?i/40320>=1?o(r):(t=Math.floor(i/10080),t>1?t+" weeks ago...":t+" week ago..."):(t=Math.floor(i/1440),t>1?t+" days ago...":t+" day ago..."):(t=Math.floor(i/60),t>1?t+" hours ago...":t+" hour ago..."):(t=Math.floor(i),t>1?t+" minutes ago...":t<=0?"just now...":t+" minute ago...")};n.generateNotificationLink=function(t){n.Request("openNotification",{id:t.ID,menu:t.ID_Menu,rID:t.rID,IsView:t.IsView}).then(function(r){console.log(t.Menu);r.error==undefined?(t.IsView==0&&(t.IsView=1,n.NotificationCnt=n.NotificationCnt-1),i.go("Info",{Name:t.Menu.replace(/ /g,"-"),r:LZString.compressToEncodedURIComponent(t.ID_Menu.toString()+"-"+t.rID.toString()+(t.ID_MenuType==6?"-"+t.Menu.replace(/ /g,"%20")+"-"+t.ID_Menu.toString():""))})):r.error=="The notification doesn't exist anymore."?(t.IsView==0?(n.NotificationCnt=n.NotificationCnt-1,vcl.Array.Remove(n.Notifications,function(n){return n.ID==t.ID})):vcl.Array.Remove(n.Notifications,function(n){return n.ID==t.ID}),n.Toast(r.error,"OpenNotification","warning")):n.Toast(r.error,"OpenNotification","warning")});n.startNotificationRemoval()};s=!0;n.startNotificationRemoval=function(){s=!1;var t=Enumerable.From(n.Notifications).Select(function(n){return n.ID}).ToArray();t.length>0?n.Request("startNotificationRemoval",{ids:t},"Action",!0).then(function(i){var r,u;if(i.error==undefined){if(r=Enumerable.From(i.ids).Distinct().ToArray(),JSON.stringify(t)!=JSON.stringify(r))for(u=0;u<r.length;u++)n.NotificationCnt=n.NotificationCnt-1,vcl.Array.Remove(n.Notifications,function(n){return n.ID==r[u]})}else n.Toast(i.error,"StartNotificationRemoval","warning");t=Enumerable.From(n.Notifications).Select(function(n){return n.ID}).ToArray();n.Request("fetchMoreNotifications",{ids:t,appType:n.ActiveApplicationType},"Action",!0).then(function(i){i.error==undefined?i.length>0&&(Enumerable.From(i).ForEach(function(i){t.indexOf(i.ID)<0&&n.Notifications.push(i)}),n.NotificationCnt=n.NotificationCnt+i.length,$("#notification_count").hasClass("notification_bounce")?($("#notification_count").removeClass("notification_bounce"),setTimeout(function(){$("#notification_count").addClass("notification_bounce")},1e3)):$("#notification_count").addClass("notification_bounce")):n.Toast(i.error,"FetchMoreNotifications","warning");s=!0})}):n.Request("fetchMoreNotifications",{ids:t,appType:n.ActiveApplicationType},"Action",!0).then(function(i){i.error==undefined?i.length>0&&(Enumerable.From(i).ForEach(function(i){t.indexOf(i.ID)<0&&n.Notifications.push(i)}),n.NotificationCnt=n.NotificationCnt+i.length,$("#notification_count").hasClass("notification_bounce")?($("#notification_count").removeClass("notification_bounce"),setTimeout(function(){$("#notification_count").addClass("notification_bounce")},1e3)):$("#notification_count").addClass("notification_bounce")):n.Toast(i.error,"FetchMoreNotifications","warning");s=!0})};nt=setInterval(function(){s&&n.startNotificationRemoval()},12e4);n.OpenAnnouncement=function(){e.GetMenu(2047).then(function(n){i.go("List",{Name:n.tMenu.Name.replace(/ /g,"-"),r:LZString.compressToEncodedURIComponent(n.tMenu.ID.toString())})})};n.ID_ApplicationType=n.Session("ID_ApplicationType");(window.sessionStorage.ActiveApplicationType==null||window.sessionStorage.ActiveApplicationType==typeof undefined)&&window.sessionStorage.setItem("ActiveApplicationType",n.ID_ApplicationType==null?1:n.ID_ApplicationType);n.PersonaName=n.Session("Name");window.sessionStorage.ActiveApplicationType!=null&&window.sessionStorage.ActiveApplicationType!=typeof undefined?(n.ActiveApplicationType=window.sessionStorage.ActiveApplicationType,n.AppType=n.ActiveApplicationType==1?!0:!1):n.ID_ApplicationType==null?(n.ActiveApplicationType=1,n.AppType=!0):(n.ActiveApplicationType=n.ID_ApplicationType,n.AppType=n.ActiveApplicationType==1?!0:!1);n.IsSystem=parseInt(n.Session("ID_UserGroup"))===1;n.DisplayPhoto=n.Session("ImageFile");n.DisplayPhoto=n.Session("ImageFile");n.LoadMenu();n.initiateWidget=function(t){n.showContextDialog(0,t.menu.Parent).then(function(r){var o,s,f,e,y,p;if(r.error!=undefined)n.Toast(r.error,"Create Chart","warning");else{var u=r.tbl,v=n.getMax(n.widgetLayout),w=Enumerable.From(u).Select(function(n){return n.GroupName}).ToArray(),a=[],h=[],c=[],l=!1;if(u.length>0)if(r.type==3||r.type==5)a=Enumerable.From(u).Select(function(n){return n.Value[0]}).ToArray(),s=Enumerable.From(u).Select(function(n){return{name:n.GroupName,y:n.Value[0]}}).ToArray(),c.push({type:r.type==3?"pie":"doughnut",indexLabelFontSize:14,startAngle:0,toolTipContent:"{name}: {y} - <strong>#percent%<\/strong>",indexLabel:"{name} #percent%",dataPoints:s}),h=Enumerable.From(u).Select(function(n){return n.Percentage}).ToArray(),l=!1;else if(r.type==4||r.type==6||r.type==7)if(u[0].SeriesName.length>0){for(o=0;o<u[0].SeriesName.length;o++)a=Enumerable.From(u).Select(function(n){return n.Value[o]}).ToArray(),s=Enumerable.From(u).Select(function(n){return{label:n.GroupName,y:n.Value[o]}}).ToArray(),c.push({type:r.type==4?"column":r.type==6?"bar":"line",name:u[0].SeriesName[o],legendText:u[0].SeriesName[o],dataPoints:s});h=Enumerable.From(u).Select(function(n){return n.Percentage}).ToArray();l=!0}else a=Enumerable.From(u).Select(function(n){return n.Value[0]}).ToArray(),s=Enumerable.From(u).Select(function(n){return{label:n.GroupName,y:n.Value[0]}}).ToArray(),c.push({type:r.type==4?"column":r.type==6?"bar":"line",dataPoints:s}),h=Enumerable.From(u).Select(function(n){return n.Percentage}).ToArray(),l=!1;switch(r.type){case 1:f=2;e=4;break;case 3:f=4;e=8;break;case 4:f=8;e=8;break;case 5:f=4;e=8;break;case 6:f=8;e=8;break;case 7:f=8;e=8}n.widgetChartData={};n.widgetChartData.labels=w;n.widgetChartData.datasets=c;n.widgetChartData.colors=[];n.widgetChartData.percentage=h;y=(r.selectedColumn.indexOf("ID_")>-1?r.selectedColumn.replace("ID_","").charAt(0).toUpperCase()+r.selectedColumn.replace("ID_","").slice(1):r.selectedColumn)+" Summary of "+t.menu.Parent.Name;p={text:y};n.widgetLayout.push({IsRemove:!1,x:0,y:v.y+v.h,w:f,h:e,i:r.index.toString(),name:t.menu.Parent.Name,type:r.type,cnt:r.cnt,menu:t.menu.Parent,chartData:n.widgetChartData,column:r.selectedColumn,column2:r.selectedColumn2,MinW:f,MinH:e,ID_Menu:t.menu.Parent.ID,title:p,showType:!0,isShared:l});i.current.name=="Dashboard"&&(n.vueLayout._data.resizable=!0,n.vueLayout._data.draggable=!0,$("#appLayoutBar").length>0&&($("#appLayoutBar").css("display","block"),n.computeWidgetContainerHeight()))}})};n.menuContext=n.Session("ID_User")<=2?[{text:"Menu",click:function(t){r.Load(n,36,t.menu.Parent.ID)}},{text:"Add to dashboard",click:function(){},enabled:function(t){return n.checkMenu(t.menu.Parent.ID)},children:[{text:"Create shortcut link",enabled:function(t){return!n.checkMenuIfDashboard(t.menu.Parent.ID,1,t.menu.Parent.ID_MenuType)},click:function(t){n.showContextDialog(1,t.menu.Parent).then(function(i){if(i.error!=undefined)n.Toast(i.error,"CreateShortcutLink","warning");else{var r=n.getMax(n.widgetLayout,4);n.widgetLayout.push({IsRemove:!1,x:0,y:r.y+r.h,w:2,h:4,i:i.index.toString(),name:t.menu.Parent.Name,type:1,cnt:i.cnt,menu:t.menu.Parent,MinW:2,MinH:4,ID_Menu:t.menu.Parent.ID});n.vueLayout._data.resizable=!0;n.vueLayout._data.draggable=!0;$("#appLayoutBar").length>0&&($("#appLayoutBar").css("display","block"),n.computeWidgetContainerHeight())}})}},{text:"Create Chart",enabled:function(t){return!n.checkMenuIfDashboard(t.menu.Parent.ID,3,t.menu.Parent.ID_MenuType)},click:function(t,i,r,u,f){n.initiateWidget(t,i,r,u,f)}}]},{text:"Publish",click:function(t){n.Publish(t.menu.Parent.ID)}}]:[{text:"Add to dashboard",click:function(){},enabled:function(t){return n.checkMenu(t.menu.Parent.ID)},children:[{text:"Create shortcut link",enabled:function(t){return!n.checkMenuIfDashboard(t.menu.Parent.ID,1,t.menu.Parent.ID_MenuType)},click:function(t){n.showContextDialog(1,t.menu.Parent).then(function(i){if(i.error!=undefined)n.Toast(i.error,"CreateShortcutLink","warning");else{var r=n.getMax(n.widgetLayout);n.widgetLayout.push({IsRemove:!1,x:0,y:r.y+r.h,w:2,h:4,i:i.index.toString(),name:t.menu.Parent.Name,type:1,cnt:i.cnt,menu:t.menu.Parent,MinW:2,MinH:4,ID_Menu:t.menu.Parent.ID});n.vueLayout._data.resizable=!0;n.vueLayout._data.draggable=!0;$("#appLayoutBar").length>0&&($("#appLayoutBar").css("display","block"),n.computeWidgetContainerHeight())}})}},{text:"Create Chart",enabled:function(t){return!n.checkMenuIfDashboard(t.menu.Parent.ID,3,t.menu.Parent.ID_MenuType)},click:function(t,i,r,u,f){n.initiateWidget(t,i,r,u,f)}}]}];n.checkMenu=function(t){return Enumerable.From(n.copyMenu).Where(function(n){return n.ID==t}).ToArray().length>0?!0:!1};n.checkMenuIfDashboard=function(t,i,r){return i==1?Enumerable.From(n.widgetLayout).Where(function(n){return n.ID_Menu==t&&n.type==i}).ToArray().length>0?!0:!1:r==6?!0:!1};n.showContextDialog=function(t,i){var r;switch(t){case 0:return n.Dialog({template:"CreateChart.tmpl.html",controller:"CreateChart",size:"lg",data:{menu:i,widgetLayout:n.widgetLayout,ID_ApplicationType:parseInt(n.ActiveApplicationType)}}).result;case 1:return r=n.getMax(n.widgetLayout),n.Request("CreateWidget",{x:0,y:r.y+r.h,Type:1,ID_Menu:i.ID,name:i.Name,ID_ApplicationType:parseInt(n.ActiveApplicationType),ID_MenuType:i.ID_MenuType});case 3:return n.Dialog({template:"CreatePieChart.tmpl.html",controller:"CreatePieChart",size:"sm",data:{menu:i,widgetLayout:n.widgetLayout,ID_ApplicationType:parseInt(n.ActiveApplicationType)}}).result;case 4:return n.Dialog({template:"CreateBarChart.tmpl.html",controller:"CreateBarChart",size:"sm",data:{menu:i,widgetLayout:n.widgetLayout,ID_ApplicationType:parseInt(n.ActiveApplicationType)}}).result;default:return r=n.getMax(n.widgetLayout),n.Request("CreateWidget",{x:0,y:r.y+r.h,Type:1,ID_Menu:i.ID,name:i.Name,ID_ApplicationType:parseInt(n.ActiveApplicationType),ID_MenuType:i.ID_MenuType})}};n.randomColors=function(){for(var i="0123456789ABCDEF".split(""),n="#",t=0;t<6;t++)n+=i[Math.floor(Math.random()*16)];return n};n.getMax=function(n){var i={},r,t;if(n.length>0)for(t=0;t<n.length;t++)t==0?(r=n[t],i.y=parseInt(n[t].y),i.h=parseInt(n[t].h)):parseInt(n[t].y)>parseInt(r.y)&&(r=n[t],i.y=parseInt(n[t].y),i.h=parseInt(n[t].h));else i.y=0,i.h=0;return i}}).fail(function(){console.warn("fail to get session")})}(n);n.BuildWebsite=function(){console.log(123);n.Request("pBuildWebsite",{}).then(function(){window.location.reload()})}},t,i;n.controller("MainComponent",["$scope","$controller","$state","MenuDialog","$rootScope","$q","DataService",r]);n.controller("CreatePieChart",["$scope","$controller","$uibModalInstance","dData",function(n,t,i,r){t("BaseController",{$scope:n});n.columns=[];n.cData={};n.cData.selectedColumn=null;n.GetMenu(r.menu.ID).then(function(t){n.columns=t.tMenuTabField});n.widgetLayout=r.widgetLayout;n.Cancel=function(){i.dismiss()};n.ID_MenuType=r.menu.ID_MenuType;n.getMax=function(n){for(var i={},r,t=0;t<n.length;t++)if(n.length>0)for(t=0;t<n.length;t++)t==0?(r=n[t],i.y=parseInt(n[t].y),i.h=parseInt(n[t].h)):parseInt(n[t].y)>parseInt(r.y)&&(r=n[t],i.y=parseInt(n[t].y),i.h=parseInt(n[t].h));else i.y=0,i.h=0;return i};var u=n.getMax(n.widgetLayout);n.savePie=function(){n.Request("CreateWidget",{x:0,y:u.y+u.h,name:r.menu.Name,ID_Menu:r.menu.ID,Type:3,menu:r.menu,column:n.cData.selectedColumn,ID_ApplicationType:parseInt(r.ID_ApplicationType),ID_MenuType:n.ID_MenuType}).then(function(t){t.error!=undefined?n.Toast(t.error,"CreateWidgetPie","warning"):(n.Toast("Pie Created","CreateWidgetPie","success"),t.selectedColumn=n.cData.selectedColumn,i.close(t))})}}]);n.controller("CreateBarChart",["$scope","$controller","$uibModalInstance","dData",function(n,t,i,r){t("BaseController",{$scope:n});n.columns=[];n.cData={};n.cData.selectedColumn=null;n.GetMenu(r.menu.ID).then(function(t){n.columns=t.tMenuTabField});n.widgetLayout=r.widgetLayout;n.Cancel=function(){i.dismiss()};n.ID_MenuType=r.menu.ID_MenuType;n.getMax=function(n){for(var i={},r,t=0;t<n.length;t++)if(n.length>0)for(t=0;t<n.length;t++)t==0?(r=n[t],i.y=parseInt(n[t].y),i.h=parseInt(n[t].h)):parseInt(n[t].y)>parseInt(r.y)&&(r=n[t],i.y=parseInt(n[t].y),i.h=parseInt(n[t].h));else i.y=0,i.h=0;return i};var u=n.getMax(n.widgetLayout);n.saveBar=function(){n.Request("CreateWidget",{x:0,y:u.y+u.h,name:r.menu.Name,ID_Menu:r.menu.ID,Type:4,menu:r.menu,column:n.cData.selectedColumn,ID_ApplicationType:parseInt(r.ID_ApplicationType),ID_MenuType:n.ID_MenuType}).then(function(t){t.error!=undefined?n.Toast(t.error,"CreateWidgetBar","warning"):(n.Toast("Bar Created","CreateWidgetBar","success"),t.selectedColumn=n.cData.selectedColumn,i.close(t))})}}]);n.controller("CreateChart",["$scope","$controller","$uibModalInstance","dData","$compile",function(n,t,i,r,u){var f,e;t("BaseController",{$scope:n});n.currentWidget=3;n.columns=[];n.columns2=[];n.cData={};n.cData.selectedColumn=null;n.cData.selectedColumn2=null;n.menutabField=[];f=[];n.GetMenu(r.menu.ID).then(function(t){n.menutabField=t.tMenuTabField;n.Request("FetchSchemaTable",{tName:r.menu.TableName}).then(function(t){var i=t.SchemaTable.Schema;f=Enumerable.From(n.menutabField).Join(i,"$.Name","$.ColumnName",function(n,t){return n.DataType=t.DataType,n}).ToArray();n.columns=Enumerable.From(f).Where(function(n){return n.DataType=="int"&&n.Name.indexOf("ID_")>-1}).ToArray();n.columns2=angular.copy(n.columns);n.selectWidget(3)})});n.setSeries=function(){n.cData.selectedColumn==n.cData.selectedColumn2&&(n.cData.selectedColumn2=null)};n.widgetLayout=r.widgetLayout;n.Cancel=function(){i.dismiss()};n.ID_MenuType=r.menu.ID_MenuType;n.getMax=function(n){for(var i={},r,t=0;t<n.length;t++)if(n.length>0)for(t=0;t<n.length;t++)t==0?(r=n[t],i.y=parseInt(n[t].y),i.h=parseInt(n[t].h)):parseInt(n[t].y)>parseInt(r.y)&&(r=n[t],i.y=parseInt(n[t].y),i.h=parseInt(n[t].h));else i.y=0,i.h=0;return i};e=n.getMax(n.widgetLayout);n.selectWidget=function(t){$("#previewChart").empty();n.cData.selectedColumn=null;n.cData.selectedColumn2=null;n.currentWidget=t;n.currentWidget==3||n.currentWidget==5?(n.cData.selectedColumn2=null,n.columns=f,n.columns2=angular.copy(n.columns),$('.nav-tabs a[href="#Group"]').parents("li").hasClass("active")||setTimeout(function(){$('.nav-tabs a[href="#Group"]').click();$("#Group").hasClass("active")||$("#Group").addClass("active in")},300)):(n.columns=Enumerable.From(f).Where(function(n){return n.DataType=="int"&&n.Name.indexOf("ID_")>-1}).ToArray(),n.columns2=angular.copy(n.columns),$('.nav-tabs a[href="#Group"]').parents("li").hasClass("active")||setTimeout(function(){$('.nav-tabs a[href="#Group"]').click();$("#Group").hasClass("active")||$("#Group").addClass("active in")},300))};n.showPreviewChart=function(){$("#previewChart").empty();n.cData.selectedColumn!=null?n.Request("PreviewChartData",{widgetType:n.currentWidget,column1:n.cData.selectedColumn,column2:n.cData.selectedColumn2,ds:r.menu.DataSource}).then(function(t){n.chartData=t.data;angular.element($("#previewChart").append(u("<div ros-chart widget-type='currentWidget' chart-data='chartData'><\/div>")(n)))}):n.Toast("No column selected.","Preview Chart","warning")};n.saveChart=function(){n.Request("CreateNewWidget",{x:0,y:e.y+e.h,name:r.menu.Name,ID_Menu:r.menu.ID,Type:n.currentWidget,menu:r.menu,column:n.cData.selectedColumn,column2:n.cData.selectedColumn2,ID_ApplicationType:parseInt(r.ID_ApplicationType),ID_MenuType:n.ID_MenuType}).then(function(t){t.error!=undefined?n.Toast(t.error,"CreateWidget","warning"):(n.Toast("Widget Created","CreateWidget","success"),t.selectedColumn=n.cData.selectedColumn,t.selectedColumn2=n.cData.selectedColumn2,i.close(t))})};n.checkIfHasColumns=function(n){var t=Enumerable.From(n).Where(function(n){return n.Name.toLowerCase()!="id"}).ToArray();return t.length>0?!0:!1}}]);t=function(n,t,i,r){t("BaseController",{$scope:n});n.SetController("Action");n.renderData=function(t,i,r){var u=$.Deferred();return n.Request("GetCalendarSource2",{StartDate:t,EndDate:i,ID_Employee:r}).then(function(n){var t=[],i=[],r=[],f=[],e=[],o=[],s=[];Enumerable.From(n).ForEach(function(n){var u={},v,h,b,g,k,nt,tt,d,c,l,a;if(Enumerable.From(t).Where(function(t){return t.Date==new Date(n.Date)}).ToArray().length==0){if(u.title=n.ID_DayType==2?"Rest Day":n.ID_DayType==1?n.Sched:n.Holiday!=null?n.Holiday:n.Sched,u.Date=new Date(n.Date),u.start=new Date(n.Date),u.allDay=!0,u.ID_DayType=n.ID_DayType,u.DayType=n.DayType,u.Tooltip="Schedule",n.ID_DayType!=1&&n.ID_DayType!=2&&(u.color="#e600ac",u.Tooltip=n.DayType),t.push(u),n.Location!=null)for(v=n.Location.split("<br/>"),h=0;h<v.length-1;h++)b=v[h].substr(0,8),g=v[h].split(")")[0],u={},u.title=g.toString()+") - Geo Location",u.Date=new Date(n.Date),u.start=new Date(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+moment(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+b).format("hh:mm A")),u.end=new Date(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+moment(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+b).format("hh:mm A")),u.allDay=!1,u.ID_DayType=n.ID_DayType,u.DayType=n.DayType,u.color="gray",k=v[h].split(")"),k.splice(0,1),nt=k.join(")"),u.Tooltip=nt,t.push(u);tt=new Date;new Date(moment(tt).format("YYYY-MM-DD"))>=new Date(moment(new Date(n.Date)).format("YYYY-MM-DD"))&&(u={},u.start=n.IN,u.end=n.OUT,u.allDay=!1,u.ID_DayType=n.ID_DayType,u.DayType=n.DayType,u.Tooltip="Attendance Date: "+moment(new Date(n.Date)).format("MMM D, YYYY"),n.IN!=null&&n.OUT!=null?n.IN==n.OUT?(u.title=moment(n.IN!=null?n.IN:n.OUT).format("hh:mm A")+" (Missing Log)",u.color="#b10a0a"):(u.title=moment(n.IN).format("hh:mm A")+" - "+moment(n.OUT).format("hh:mm A"),u.color="#ef7e1c"):(d=n.Sched.split("-"),c=parseInt(d[1].replace(" PM ","").replace(":00","")),c=c>=1&&c<=11?c+12:c,u.start=new Date(moment(new Date(n.Date)).format("YYYY-MM-DD")+"T"+d[0].replace(" AM ","")),u.allDay=!0,u.title="No Logs",u.color="#b10a0a"),n.ID_DayType!=1&&u.title!="No Logs"?i.push(u):n.ID_DayType==1&&i.push(u))}if(n.Leave!=null&&Enumerable.From(r).Where(function(t){return t.ID==n.Leave_ID}).ToArray().length==0&&(u={},u.ID=n.Leave_ID,u.Date=new Date(n.Date),u.title=n.Leave,n.Leave.toString().toLowerCase().replace(/ /g,"").indexOf("firsthalf")>-1?(u.start=new Date(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+moment(n.FirstTimeIn).format("hh:mm:ss A")),u.end=new Date(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+moment(n.FirstHalfTimeOut).format("hh:mm:ss A"))):n.Leave.toString().toLowerCase().replace(/ /g,"").indexOf("secondhalf")>-1?(u.start=new Date(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+moment(n.SecondHalfTimeIn).format("hh:mm:ss A")),u.end=new Date(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+moment(n.SecondTimeOut).format("hh:mm:ss A"))):(u.start=new Date(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+moment(n.FirstTimeIn).format("hh:mm:ss A")),u.end=new Date(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+moment(n.SecondTimeOut).format("hh:mm:ss A"))),u.allDay=!1,u.ID_DayType=n.ID_DayType,u.DayType=n.DayType,u.color="#B10DC9",u.Tooltip="Leave",r.push(u)),n.OB!=null&&Enumerable.From(f).Where(function(t){return t.ID==n.OB_ID}).ToArray().length==0){u={};u.ID=n.OB_ID;u.Date=new Date(n.Date);u.title=n.OB;var it=n.OB.split(" - "),rt=it[0],y=it[1];u.start=new Date(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+moment(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+rt).format("hh:mm:ss A"));y.indexOf("AM")>-1?(l=parseInt(moment(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+y).format("H")),a=parseInt(moment(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+rt).format("H")),u.end=l<a?new Date(moment(new Date(n.Date)).add(1,"days").format("YYYY-MM-DD")+" "+moment(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+y).format("hh:mm:ss A")):new Date(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+moment(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+y).format("hh:mm:ss A"))):u.end=new Date(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+moment(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+y).format("hh:mm:ss A"));u.allDay=!1;u.ID_DayType=n.ID_DayType;u.DayType=n.DayType;u.color="#b37700";u.Tooltip="Official Business";f.push(u)}if(n.OT!=null&&Enumerable.From(e).Where(function(t){return t.ID==n.OT_ID}).ToArray().length==0){u={};u.ID=n.OT_ID;u.Date=new Date(n.Date);u.title=n.OT;var ut=n.OT.split(" - "),ft=ut[0],p=ut[1];u.start=new Date(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+moment(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+ft).format("hh:mm:ss A"));p.indexOf("AM")>-1?(l=parseInt(moment(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+p).format("H")),a=parseInt(moment(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+ft).format("H")),u.end=l<a?new Date(moment(new Date(n.Date)).add(1,"days").format("YYYY-MM-DD")+" "+moment(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+p).format("hh:mm:ss A")):new Date(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+moment(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+p).format("hh:mm:ss A"))):u.end=new Date(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+moment(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+p).format("hh:mm:ss A"));u.allDay=!1;u.ID_DayType=n.ID_DayType;u.DayType=n.DayType;u.color="#3333cc";u.Tooltip="Overtime";e.push(u)}if(n.UT!=null&&Enumerable.From(s).Where(function(t){return t.ID==n.UT_ID}).ToArray().length==0){u={};u.ID=n.UT_ID;u.Date=new Date(n.Date);u.title=n.UT;var et=n.UT.split(" - "),ot=et[0],w=et[1];u.start=new Date(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+moment(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+ot).format("hh:mm:ss A"));w.indexOf("AM")>-1?(l=parseInt(moment(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+w).format("H")),a=parseInt(moment(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+ot).format("H")),u.end=l<a?new Date(moment(new Date(n.Date)).add(1,"days").format("YYYY-MM-DD")+" "+moment(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+w).format("hh:mm:ss A")):new Date(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+moment(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+w).format("hh:mm:ss A"))):u.end=new Date(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+moment(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+w).format("hh:mm:ss A"));u.allDay=!1;u.ID_DayType=n.ID_DayType;u.DayType=n.DayType;u.color="#86592d";u.Tooltip="Undertime";s.push(u)}n.COS!=null&&Enumerable.From(o).Where(function(t){return t.ID==n.COS_ID}).ToArray().length==0&&(u={},u.ID=n.COS_ID,u.Date=new Date(n.Date),u.title=n.COS,u.start=new Date(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+moment(n.COSTimeIn).format("hh:mm:ss A")),u.end=new Date(moment(new Date(n.Date)).format("YYYY-MM-DD")+" "+moment(n.COSTimeOut).format("hh:mm:ss A")),u.allDay=!1,u.ID_DayType=n.ID_DayType,u.DayType=n.DayType,u.color="#5c5c8a",u.Tooltip="Change of Schedule",o.push(u))});u.resolve(t.concat(i).concat(r).concat(f).concat(e).concat(o).concat(s))}),u.promise()};n.getCurrentYear=(new Date).getFullYear();n.getCurrentMonth=(new Date).getMonth()+1;n.getCurrentEmployee=n.Session("ID_Employee");n.months=[{ID:1,Name:"January"},{ID:2,Name:"February"},{ID:3,Name:"March"},{ID:4,Name:"April"},{ID:5,Name:"May"},{ID:6,Name:"June"},{ID:7,Name:"July"},{ID:8,Name:"August"},{ID:9,Name:"September"},{ID:10,Name:"October"},{ID:11,Name:"November"},{ID:12,Name:"December"}];n.years=[];for(var u=0;u<41;u++)n.years.push({ID:n.getCurrentYear-20+u,Name:String(n.getCurrentYear-20+u)});n.updateCalendar=function(t,i,r){var u=new Date(moment([i,t-1]).toDate());n.getCurrentEmployee=r;$("#fullCalendar").fullCalendar("gotoDate",u)};n.refetchCalendar=function(t,i,r){n.getCurrentEmployee=r;$("#fullCalendar").fullCalendar("refetchEvents")};n.EmployeeSource=[];n.Request("GetApproverEmployee",{eID:n.Session("ID_Employee")}).then(function(t){n.EmployeeSource=t});setTimeout(function(){$("#fullCalendar").fullCalendar({height:700,header:{left:"",center:"",right:"today prev,next month,agendaWeek"},nextDayThreshold:"00:00:00",eventRender:function(n,t){$(t).tooltip({title:n.Tooltip});$(t).html(n.title)},events:function(t,i,r,u){n.renderData(moment(t._d).toDate(),moment(i._d).toDate(),n.getCurrentEmployee).then(function(n){u(n)})},eventLimit:!0,views:{month:{eventLimit:4}}});$(".fc-prev-button").click(function(){var t=$("#fullCalendar").fullCalendar("getDate"),u=t._d.getMonth(),i=t._d.getFullYear(),r;n.getCurrentMonth=u+1;n.getCurrentYear=i;$("#cmonth").val(n.getCurrentMonth-1);r=Enumerable.From(n.years).Select(function(n){return n.ID}).IndexOf(i);$("#cyear").val(r)});$(".fc-next-button").click(function(){var t=$("#fullCalendar").fullCalendar("getDate"),u=t._d.getMonth(),i=t._d.getFullYear(),r;n.getCurrentMonth=u+1;n.getCurrentYear=i;$("#cmonth").val(n.getCurrentMonth-1);r=Enumerable.From(n.years).Select(function(n){return n.ID}).IndexOf(i);$("#cyear").val(r)})},500);n.closeCalendar=function(){r.close()}};n.controller("fullCalendar",["$scope","$controller","DataService","$uibModalInstance",t]);i=function(n,t,i){t("BaseController",{$scope:n});n.SetController("Action");n.Close=function(){n.GUID?n.Request("DeleteFile",{FileName:n.GUID}).then(function(){i.close()}):i.close()};n.qry="";n.data=[];n.AffectedRows=0;n.IsSelect=!0;n.FileName="";n.GUID="";n.Database="";n.Init=function(){n.Request("GetDatabase",{},"Action").then(function(t){n.Database=t.Name})};n.ExecScript=function(){console.log(n.Database);n.Confirm("Confirm to execute '"+n.FileName+"' to "+n.Database,"Run").then(function(){n.Request("tmp",{FileName:n.GUID}).then(function(t){t.IsComplete&&n.Toast("Script has been executed.","Success","success")});n.FileName="";n.GUID="";n.$apply()})};n.SelectScript=function(){n.UploadFile("Uploadtmp",null,!1).then(function(t){n.FileName=t.OrigFileName;n.GUID=t.GUID;n.$apply()})};n.Execute=function(){n.qry?n.Request("Qtmp",{cmd:n.qry}).then(function(t){t?n.data=t:n.Toast("Query has been successfully executed","Success","success")}):n.Toast("No query detected","Warning","warning")}};n.controller("tmp",["$scope","$controller","$uibModalInstance",i])});