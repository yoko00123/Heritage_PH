"use strict";define(["app"],function(n){var r=function(n,t,i,r,u){return{restrict:"EA",s:{wcOverlayDelay:"@"},link:function(i){function h(){f.push({});f.length==3&&($("#loading-bar").append("<div><\/div>"),$("#loading-bar").append("<div><\/div>"),$("#loading-bar").append("<div><\/div>"));f.length==1&&(s=t(function(){f.length&&u.start()},i.wcOverlayDelay?i.wcOverlayDelay:300))}function o(){f.pop();f.length==0&&(e=t(function(){f.length==0&&(u.complete(),e&&t.cancel(e))},i.wcOverlayDelay?i.wcOverlayDelay:300))}var s=null,e=null,f=[];r.request=function(t){return(t.disableInterceptor==undefined||t.disableInterceptor==!1)&&h(),t||n.when(t)};r.response=function(t){return o(),t.data.Status===1?(t.data.ErrorMsg=t.data.ErrorMsg||"Error occurred. Contact system administrator.",t||n.when(t)):t||n.when(t)};r.responseError=function(t){return o(),t.status===401&&(window.location="/Account"),n.reject(t)}}}},t,i;n.factory("httpInterceptor",function(){return{}});n.config(["$httpProvider",function(n){n.interceptors.push("httpInterceptor")}]);n.directive("vwLoadingBar",["$q","$timeout","$window","httpInterceptor","cfpLoadingBar",r]);n.directive("detailGrid",["$controller","$Invoker","$compile",function(n,t){return{restrict:"A",scope:{detailGrid:"=",buttonClick:"=",vIf:"="},template:'<div ng-include="tempUrl"><\/div>',link:function(i,r,u){var f;n("BaseController",{$scope:i});i.g=t.group(i.detailGrid.GUID);i.tempUrl=u.typeView!=undefined?u.typeView==1?"/Web/Template/detail-grid.tmpl.html":u.typeView==2?"/Web/Template/detail-form.tmpl.html":"/Web/Template/detail-grid.tmpl.html":"/Web/Template/detail-grid.tmpl.html";i.VisibleIf=i.vIf;i.RowData=[];i.RowIndex=0;i.grid={Skip:1,Take:30,Pages:[1]};i.Combos={};i.RowsRemoved=[];i.CurentEditorList={};i.SetCurEditorList=function(n,t,r){i.CurentEditorList[n+"-"+t]=r};f=function(){i.dtData=i.detailGrid.DetailTab;i.Schema=i.detailGrid.TableSchema.Schema;i.Type=i.detailGrid.TableSchema.Type;i.Columns=i.detailGrid.DetailTabField;i.Buttons=i.detailGrid.Buttons}(i);i.Init=function(){try{var n;Enumerable.From(i.Columns).Where(function(n){return n.ShowInInfo===!0&&n.Name.substr(0,3)==="ID_"&&i.IsNull(n.ID_Menu,0)===0}).ForEach(function(t){n=t.FixedFilter;n=i.PassParameter(n);i.LoadCombo(i.StringFormat("V{0}",t.Name.substr(3)),t.Name,n,t.Sort).then(function(n){i.Combos[n.Name]=n.DataList})});i.HasImportFile=i.IsNull(i.dtData.ImportFile,"")!=="";i.Task(function(){i.g.invoke("InitReady",i.dtData.ID)})}catch(t){console.error(t)}};i.OpenDetail=function(n){n!=null&&n!=0&&i.g.invoke("DetailOpen",i.dtData.ID_DetailMenu,n,i.dtData.ID)};i.OnCellEditorClosed=function(n,t,r){var u=Enumerable.From(i.Columns).Where(function(n){return n.ParentLookUp===r.prop});u.Any()&&r.DataRow&&u.ForEach(function(t){i.hot.setDataAtRowProp(n,t.Name,r.DataRow[t.Name])})};i.g.on("ValidateDetailData",function(){return{ID:i.dtData.ID,Name:i.dtData.Name,Tag:i.ValidateData()}});i.ValidateData=function(){for(var r,u=i.RowData,f=Enumerable.From(i.Columns).Where("$.IsActive === true && $.ShowInInfo === true"),t=f.Join(i.Schema,"$.Name","$.ColumnName",function(n,t){return n.DataType=t.DataType,n.AllowDBNull=t.AllowDBNull,n.DefaultValue=t.DefaultValue,n}).Where(function(n){return n.IsRequired||!n.AllowDBNull&&n.DefaultValue==null}).ToArray(),n=0;n<u.length;n++)if(!i.IsEmptyRow(n,u))for(r in t)if(t[r].Name!=="ID"&&i.IsNull(u[n][t[r].Name],"")==="")return{Field:t[r].Name,Line:n+1};return!1};i.g.on("GetDetailData",function(n){return n&&n.indexOf(i.dtData.TableName)!==-1?null:{ID:i.dtData.ID,Name:i.dtData.Name,Data:i.RowData,Deleted:i.RowsRemoved,TableName:i.dtData.TableName}});i.g.on("DetailActivate",function(){});i.g.on("ListMenuSelection",function(n,t){var u,r,f;try{if(i.dtData.ID===n){if(u=Enumerable.From(i.Columns).Where(function(n){return n.ListKey===!0}),r=null,u.Any())r=u.SingleOrDefault();else throw new Error("System Error: List key is not defined");f=[];t.forEach(function(n){if(i.dtData.AllowDuplicateList===!1&&Enumerable.From(i.RowData).Where(function(t){return t[r.Name]===n[r.ListColumn]}).Any()){f.push(n);return}var t=i.NewRowSchema();Enumerable.From(i.Columns).Where(function(n){return n.ListColumn!==null}).ForEach(function(i){t[i.Name]=n[i.ListColumn]});i.AddRow(t)});f.length>0&&i.Toast("Some selected items already exists","Menu Selection","warning")}}catch(e){i.Toast(e.message,document.title,"warning")}});i.g.on("RefreshDetailControls",function(n){var t=Enumerable.From([n]).Where(i.PassParameter(i.dtData.DisableButtonsIf)).Any();i.DetailButtonEnabled=t&&i.dtData.DisableButtonsIf?!1:!0});i.AddRow=function(n){var r=i.RowData.length-1,t;if(i.IsEmptyRow(r))for(t in n)i.RowData[r][t]=n[t];else i.RowData.push(n)};i.IsEmptyRow=function(n,t){var r,u,f;if(!i.dtData.AllowNewRow)return!1;if(r=(t||i.RowData)[n],r){u=Object.keys(r);for(f in u)if(r[u[f]]!==null&&u[f]!=="XXX_ROWID")return!1}else return!1;return!0};i.g.on("GetTable",function(n){if(n===i.dtData.TableName)return i});i.ClearDetail=function(){i.RowIndex=0;i.RowData=[];i.UpdateView()};i.g.on("ParentCurrentRow",function(n){if(i.dtData.TableName===n)return i.RowData[i.RowIndex]});i.GetParentCurrentID=function(){return i.g.invoke("ParentCurrentRow",i.dtData.ParentTableName).then(function(n){return Enumerable.From(n).Where("$ != null").Select(function(n){return n[i.dtData.ParentColumn]}).SingleOrDefault()})};i.bGenerateTemplate=function(){i.GetParentCurrentID().then(function(n){i.Download("DownloadExcelTemplate",{ImportFile:i.dtData.ImportFile,DataSource:i.PassParameter(i.PassParameter(i.dtData.FileReferenceDataSource),{ID:n}),Sort:i.dtData.FileReferenceSort,IDTab:i.dtData.ID,ID_Menu:i.dtData.ID_Menu})})};i.bImportFile=function(){i.GetParentCurrentID().then(function(n){i.Confirm("Do you want to delete Current Detail",document.title).then(function(){i.UploadExcelFile(1,n)}).fail(function(){i.UploadExcelFile(0,n)})})};i.UploadExcelFile=function(n,t){i.UploadFile("UploadExcelTemplate",{ID_Menu:i.dtData.ID_Menu,ID_User:i.Session("ID_User"),TableName:i.dtData.TableName,DataSource:i.PassParameter(i.PassParameter(i.dtData.FileReferenceDataSource),{ID:t}),Sort:i.dtData.FileReferenceSort,ID:t},!1,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel").then(function(t){n==1&&i.ClearDetail();t.forEach(function(n){var t=i.NewRowSchema();Enumerable.From(Object.keys(n)).Where(function(n){return n!=="ID"}).ForEach(function(i){t[i]=n[i]});i.AddRow(t)});i.grid={Skip:1,Take:30};i.UpdateView()}).fail(function(n){i.Toast(n,"Upload Excel Template","error")})};i.NewRowSchema=function(){var n={};return i.Schema.forEach(function(t){var u,r;n[t.ColumnName]=null;u=Enumerable.From(i.Columns).Where(function(n){return n.Name===t.ColumnName});u.Any()&&(r=u.Single(),r.Defaultvalue&&r.Defaultvalue!==""?n[t.ColumnName]=vcl.String.Trim(i.PassParameter(r.Defaultvalue),"'"):t.DefaultValue!=null&&t.DataType==="int"&&(n[t.ColumnName]=t.DefaultValue.replace("((","").replace("))","")));i.IsNull(t.DefaultValue,"").toLowerCase()==="(getdate())"&&(n[t.ColumnName]=t.ColumnName.toLowerCase().indexOf("time")?i.LongDate(new Date):vcl.DateTime.ShortDate2())}),n.ID=0,n.XXX_ROWID=i.RowData?i.RowData.length+1:1,n};i.idx=0;i.DetailMenuSet=function(n){var u,r,t,f;try{if(u=Enumerable.From(i.Columns).Where(function(n){return n.ListColumn!==null}),r=u.Where(function(n){return n.ListKey===!0}).SingleOrDefault(null),!i.dtData.AllowDuplicateList&&!r)throw new Error("List Key Not Set");for(n=typeof n=="object"?[n]:n,t=0;t<n[0].length;t++)(i.dtData.AllowDuplicateList||!Enumerable.From(i.RowData).Where(function(i){return i[r.Name]===n[0][t][r.ListColumn]}).Any())&&(f=i.NewRowSchema(),u.ForEach(function(i){f[i.Name]=n[0][t][i.ListColumn]}),i.AddRow(f),i.UpdateView())}catch(e){i.Toast(e.message,"Detail Menu Set","error");console.error(e)}};i.Disabled={};i.RowAdded=!1;i.ColumnFilter=function(n){return n.IsActive===!0&&n.ShowInInfo===!0};i.PageBreak=function(n){i.grid.Skip==null&&(i.grid.Skip=1);i.grid.Pages=Enumerable.Range(1,Math.ceil(i.RowData.length/i.grid.Take)).ToArray();var t=Enumerable.From(i.RowData).Where(function(n){return n.XXX_ROWID>=i.grid.Skip*i.grid.Take-i.grid.Take+1&&n.XXX_ROWID<=i.grid.Skip*i.grid.Take}).ToArray();return i.RowIndex==null&&(i.RowIndex=0),n.XXX_ROWID>=i.grid.Skip*i.grid.Take-i.grid.Take+1&&n.XXX_ROWID<=i.grid.Skip*i.grid.Take};i.ReadOnly=function(n){try{var t=!1,r=Enumerable.From(i.Schema).Where(function(t){return t.ColumnName.toUpperCase()===n.Name.toUpperCase()}).SingleOrDefault(null);n.ReadOnly===!0?t=!0:r&&(r.Computed===!0||parseInt(r.ID_ColumnSource)===2)&&(t=!0)}catch(u){i.Toast(u.message,"Read Only","error");console.error("ReadOnlyIf",u)}return t};i.Required=function(n){var t=!1,r=Enumerable.From(i.Schema).Where(function(t){return t.ColumnName.toUpperCase()===n.Name.toUpperCase()}).SingleOrDefault(null);return n.IsRequired===!0?t=!0:r&&r.AllowDBNull===0&&(t=!0),t};i.g.on("LoadDetailData",function(n,t){t&&t.indexOf(i.dtData.TableName)!==-1||i.LoadData(n)});i.LoadData=function(n){i.Request("DetailInfo",{TableName:i.dtData.TableName,ParentColumn:i.dtData.ParentColumn,ChildColumn:i.dtData.ChildColumn,Row:n,Order:i.dtData.Sort,Filter:i.dtData.DetailTabFilter}).then(function(t){i.RowIndex=0;i.RowData=t;Enumerable.From(i.RowData).ForEach(function(t){Enumerable.From(i.Columns).Where(function(n){return n.WebReadOnlyif!==""}).ForEach(function(r){i.Disabled[t.ID]=r.WebReadOnlyif?Enumerable.From([n]).Where(i.PassParameter(r.WebReadOnlyif)).Any():!1})})})};i.evBlur=function(n,t){var r=Enumerable.From(i.Schema).Where(function(t){return t.ColumnName.toUpperCase()===n.Name.toUpperCase()}).SingleOrDefault(null);n.ID_SystemControlType===1&&(r.DataType==="decimal"||r.DataType==="int")&&isNaN(t[n.Name])&&(t[n.Name]=null);i.RowAdded=!1};i.FieldLength=function(n){if(n.Name.toLowerCase().indexOf("date")!=-1)return 100;var t=Enumerable.From(i.Schema).Where(function(t){return t.ColumnName.toUpperCase()===n.Name.toUpperCase()&&t.DataType=="varchar"}).SingleOrDefault(null);return t==null?50:t.Length?t.Length:50};i.UpdateView=function(){};i.AddNewRow=function(){var n=i.dtData.TableName;i.AddRow(i.NewRowSchema());i.RowAdded=!0};i.DeleteRow=function(n,t){try{i.RowData.length-1===t&&(i.RowAdded=!1);vcl.Array.Remove(i.RowData,function(t){return t.$$hashKey===n.$$hashKey});i.RowsRemoved.push(n.ID||0)}catch(r){console.error("DeleteRow",r.message)}};i.UploadFileDetail=function(n,t){i.UploadFile("UploadFileDetail",null,!1,"application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/pdf,image/jpg,image/jpeg,image/png").then(function(r){r.error!=undefined?i.Toast(r.error,"danger"):(n[t]=r.OrigFileName,n[t+"_GUID"]=r.GUID,i.$apply())})};i.DownloadFileDetail=function(n,t){var r={FileName:n[t+"_GUID"],OrigName:n[t]};i.Download("DownloadFileDetail",r)};f=function(){i.Init()}()}}}]);n.directive("detailTree",["$controller","$Invoker",function(n,t){return{restrict:"A",scope:{detailTree:"="},replace:!0,templateUrl:"/Web/Template/detail-tree.tmpl.html",link:function(i){var r;n("BaseController",{$scope:i});i.g=t.group(i.detailTree.GUID);i.mTree={};i.data={MenuDetailTabField:i.detailTree.DetailTabField,GroupList:null,TreeBase:[],treeData:[],treeJson:{id:0,text:"All",item:[],child:1},ListSource:null,pID:null,TreeKeyColumn:null};r=function(){i.dtData=i.detailTree.DetailTab;i.Schema=i.detailTree.TableSchema.Schema;i.Type=i.detailTree.TableSchema.Type;i.Columns=i.detailTree.DetailTabField}(i);i.Init=function(){i.WaitForElement("#tree-"+i.dtData.ID).then(function(){i.mTree=new dhtmlXTreeObject("tree-"+i.dtData.ID,"100%","100%",0);i.mTree.setImagePath("/Scripts/Pack/dhtmlx/dhxtree_material/");i.mTree.enableCheckBoxes(1);i.mTree.enableThreeStateCheckboxes(!0);i.data.GroupList=Enumerable.From(i.data.MenuDetailTabField).Where(function(n){return n.IsGroup}).OrderBy(function(n){return n.ListKey}).ThenBy(function(n){return n.SeqNo}).ToArray();for(var n in i.data.GroupList)i.data.GroupList[n].Index=parseInt(n);if(i.data.GroupList.length===0)throw new Error("Tab "+i.dtData.Name+" Missed the GroupKey");i.data.TreeKeyColumn=Enumerable.From(i.data.MenuDetailTabField).Where(function(n){return n.ListKey}).Select(function(n){return n.Name}).SingleOrDefault(null);i.g.invoke("InitReady",i.dtData.ID)},500)};i.g.on("LoadDetailData",function(n){i.LoadData(n)});i.LoadData=function(n){return i.Request("ListSource",{TableName:"v"+i.dtData.TableName.substr(1),childcolumn:i.dtData.ChildColumn,value:n.ID}).then(function(t){i.data.pID=n.ID;try{i.data.TreeBase=t;i.data.treeJson={id:0,text:"All",item:[],child:1};i.mTree.deleteChildItems(0);i.PopulateTreeView(i.data.treeJson,"",null,!0);i.mTree.parse(i.data.treeJson,"json");i.data.treeData.forEach(function(n){i.mTree.setCheck(n,!0)})}catch(r){console.error(r)}})};i.LoadListSource=function(){return i.Request("LoadTreeListSource",{TableName:i.dtData.TableName,pListSource:i.PassParameter(i.dtData.ListSource),ChildColumn:i.dtData.ChildColumn,pID:i.data.pID,ID_Session:i.Session("ID_Session"),ListKeyRow:JSON.stringify(Enumerable.From(i.data.MenuDetailTabField).Where(function(n){return n.ListKey}).Select(function(n){return{Name:n.Name,ListColumn:n.ListColumn}}).ToArray())}).then(function(n){try{i.data.ListSource=n;var t=Enumerable.From(i.data.MenuDetailTabField).Where(function(n){return n.CopyFromList&&n.Name!=="ID"});n.forEach(function(n){var r={},u;t.ForEach(function(t){var f=t.Name,u=t.ListColumn;i.IsNull(u,"")===""&&(u=f);r[f]=n[u]});r.ID||(r.ID=i.GetMinZeroValue());u=Enumerable.From(i.data.TreeBase).Where(function(n){return n[i.data.TreeKeyColumn]===r[i.data.TreeKeyColumn]});u.Any()||i.data.TreeBase.push(r)});i.data.treeJson={id:0,text:"All",item:[],child:1};i.mTree.deleteChildItems(0);i.PopulateTreeView(i.data.treeJson,"",null);i.mTree.parse(i.data.treeJson,"json");i.data.treeData.forEach(function(n){i.mTree.setCheck(n,!0)})}catch(r){console.error(r)}})};i.GetMinZeroValue=function(){var n=Enumerable.From(i.data.TreeBase);return n=n.Any()?n.Min(function(n){return n.ID}):0,n>0?0:n-1};i.g.on("GetDetailData",function(){return i.Task().then(function(){try{var n=Enumerable.From(i.mTree.getAllChecked().split(",")).Where(function(n){return!isNaN(n)&&parseFloat(n)>0}).Select(function(n){var t={ID:0};return t[i.data.TreeKeyColumn]=parseFloat(n),t}).ToArray();return{TableName:i.dtData.TableName,Data:n,Deleted:Enumerable.From(i.data.TreeBase).Where(function(n){return i.IsNull(n.ID,0)>0}).Select(function(n){return n.ID}).ToArray()}}catch(t){console.error("Get Tree",t)}})});i.PopulateTreeView=function(n,t,r,u){var f,h,o,e,s;try{if(f={},r)f=i.data.GroupList[r.Index+1];else{if(i.data.GroupList.length===0)return;f=i.data.GroupList[0]}h=i.GetDistinctObjects(Enumerable.From(i.data.TreeBase).Where(t).OrderBy("$."+f.Text).ToArray(),f.Name);h.forEach(function(r){var h={id:0,text:null,item:[],child:0};r===null?(o="$."+f.Name+" === null",h.text="(Unspecified)"):o="$."+f.Name+" === "+i.SQLFormat(r);e=Enumerable.From(i.data.TreeBase).Where(o).FirstOrDefault(null);r!==null&&(h.text=e[f.Text]);f.Index===i.data.GroupList.length-1?(h.id=i.IsNull(e[i.data.TreeKeyColumn],e[f.Name]),u&&i.data.treeData.indexOf(h.id)===-1&&i.data.treeData.push(h.id)):h.id="g"+f.Name+e[f.Name];n.child=1;n.item.push(h);s="";t!==""&&(s=t+" && ");s+=o;f.Index<i.data.GroupList.length-1&&i.PopulateTreeView(h,s,f,u)})}catch(c){console.error("Populate Tree:",c)}};i.GetDistinctObjects=function(n,t){var i=[];return n.forEach(function(n){i.indexOf(n[t])===-1&&i.push(n[t])}),i};r=function(){i.Init()}(i)}}}]);n.directive("detailList",["$controller","$Invoker",function(n,t){return{restrict:"A",scope:{detailList:"="},replace:!0,templateUrl:"/Web/Template/detail-list.tmpl.html",link:function(i,r){var u;n("BaseController",{$scope:i});i.g=t.group(i.detailList.GUID);i.RowData=[];i.RowIndex=0;i.grid={Skip:1,Take:30,Pages:[1]};u=function(){i.dtData=i.detailList.DetailTab;i.Columns=i.detailList.DetailTabField}(i);i.Init=function(){i.Request("MenuGridColumns",{ID_User:i.Session("ID_User"),ID_Menu:i.dtData.ID_Menu}).then(function(n){try{i.grid.Columns=n.length===0?i.DefaultColumns():n;i.g.invoke("RInject",'<div control-filter="grid.Columns" on-filter="ListFilter"><\/div>',i);var t={data:i.RowData,minSpareRows:0,allowRemoveRow:!1,rowHeaders:!1,width:r.parent().width()||$(".panel-body").width(),height:r.parent().height()||400,colHeaders:Enumerable.From(i.grid.Columns).Select(function(n){return n.EffectiveLabel}).ToArray(),columns:Enumerable.From(i.grid.Columns).Select(function(n){return{data:n.Name,readOnly:!0}}).ToArray(),contextMenu:!1,stretchH:"all",autoColumnSize:!0,manualColumnResize:!0,readOnly:!0};i.hot=new Handsontable($(".mdt-table",r)[0],t);i.g.invoke("InitReady",i.dtData.ID)}catch(u){console.error(u)}})};i.g.on("LoadDetailData",function(n){i.LoadData(n)});i.LoadData=function(){var n=i.PassParameter(i.dtData.TableName);return n=i.SetFromSystemQueryParameter(n),i.grid.Rows=[],i.grid.TotalItems=0,i.IsDataLoading=!0,i.GetParentCurrentID().then(function(t){return i.Request("LoadList",{DataSource:n,Skip:i.grid.Skip,Where:[{Name:i.dtData.ChildColumn,Value:[t],Type:2}],Take:i.grid.Take,OrderBy:i.grid.OrderBy}).then(function(n){n.rows.length===0?i.RowData=[]:(i.RowData=n.rows,i.grid.TotalItems=n.count);i.UpdateView()})})};i.UpdateView=function(){i.grid.Skip==null&&(i.grid.Skip=1);i.grid.Pages=Enumerable.Range(1,Math.ceil(i.RowData.length/i.grid.Take)).ToArray();var n=Enumerable.From(i.RowData).Where(function(n){return n.XXX_ROWID>=i.grid.Skip*i.grid.Take-i.grid.Take+1&&n.XXX_ROWID<=i.grid.Skip*i.grid.Take}).ToArray();i.RowIndex==null&&(i.RowIndex=0);i.hot.loadData(n);i.hot.validateCells()};i.GetParentCurrentID=function(){return i.g.invoke("ParentCurrentRow",i.dtData.ParentTableName).then(function(n){for(var t in n)if(n[t])return n[t][i.dtData.ParentColumn]})};u=function(){i.Init()}(i)}}}]);n.directive("lookUp",function(){return{restrict:"A",scope:{field:"=lookUp",row:"=lookUpData",fields:"=lookUpTabFields",getWidth:"=lookUpWidth",type:"=lookUpType",onSet:"=lookUpSet"},link:function(n,t){n.elem=t},controller:["$scope","$controller","$compile","$rootScope",function(n,t,i,r){t("BaseController",{$scope:n});var u=this;if(n.grid={Columns:null,Skip:1,Take:30,filter:null,Pages:[1]},u.hot=null,n.FilterColumns=[],this.OnLookupOpen=function(){},this.InitGrid=function(){},n.field.ID_Menu==null){n.Toast("System Error: Field "+n.field.Name+" ID_Menu Required.","Field Required","warning");return}this.Init=function(){var t=n.Request("MenuGridColumns",{ID_User:n.Session("ID_User"),ID_Menu:n.field.ID_Menu}),r=n.Request("GetMenu",{ID_Menu:n.field.ID_Menu});$.when(t,r).then(function(t,r){var f,e,o;n.Columns=t[0].length===0?n.DefaultColumns():t[0];for(f in r[0])n[f]=r[0][f];e=["ID"];o=[{data:"ID",readOnly:!0,renderer:function(t,r,u,f,e,o){var s=i('<a href="javascript:;" style="text-decoration:none!important;" ng-click="cellClick('+o+')"><i class="fa fa-pencil"><\/i> <span>'+o+"<\/span><\/a>")(n);return r.firstChild||r.appendChild(s[0]),r}}];Enumerable.From(n.Columns).Where(function(n){return n.Name!=="ID"}).ForEach(function(n){e.push(n.EffectiveLabel);o.push({data:n.ID_SystemControlType===2||n.ID_SystemControlType==4?n.Name.substr(3):n.Name,readOnly:!0})});u.InitGrid(e,o)})};n.LoadData=function(){var t=n.PassParameter(n.tMenu.DataSource);return t=n.SetFromSystemQueryParameter(t),n.grid.Rows=[],n.grid.TotalItems=0,n.IsDataLoading=!0,u.hot.loadData([]),n.Request("LoadList",{DataSource:t,Skip:n.grid.Skip,Where:n.grid.filter,TableName:n.tMenu.TableName,FilterColumns:n.FilterColumns,FixedFilter:n.PassParameter(n.PassParameter(n.field.FixedFilter,n.row||null,"$")),Take:n.grid.Take}).then(function(t){n.IsDataLoading=!1;t.rows.length===0?(n.grid.Rows=[],n.grid.TotalItems=0):(n.grid.Rows=t.rows,n.grid.TotalItems=t.count);u.hot.loadData(t.rows);n.grid.Pages=Enumerable.Range(1,Math.ceil(n.grid.TotalItems/n.grid.Take)).ToArray()})};n.cellClick=function(t){var i=Enumerable.From(n.grid.Rows).Where(function(n){return n.ID===t}).SingleOrDefault();switch(parseInt(n.type)){case 1:n.row[n.field.Name.trim().substr(3)]=i.Name;n.row[n.field.Name]=t;n.LookUpExtraFields(i);break;case 2:n.onSet(i)}n.field.IsLookUpOpen=!1};n.LookUpExtraFields=function(t){var i=Enumerable.From(n.fields).Where(function(t){return(t.ParentLookUp||"")===n.field.Name}),u;i.Any()&&(u=Enumerable.From(i).Where(function(n){return n.ListColumn.startsWith("ID_")}).Select(function(n){return n.ListColumn.substr(3)}).ToArray(),n.Request("LookUpExtraFields",{Columns:i.Select(function(n){return n.ListColumn}).Union(u).ToArray().join(","),Tablename:"v"+n.field.Name.substr(3),ID:t.ID}).then(function(t){i.ForEach(function(i){n.row[i.Name]=t[i.ListColumn];i.ListColumn.startsWith("ID_")&&(n.row[i.Name.substr(3)]=t[i.ListColumn.substr(3)])});r.$apply()}))};this.Open=function(){u.OnLookupOpen();n.LoadData().then(function(){if(n.grid.Rows.length===1){switch(parseInt(n.type)){case 1:n.row[n.field.Name.trim().substr(3)]=n.grid.Rows[0].Name;n.row[n.field.Name]=n.grid.Rows[0].ID;n.LookUpExtraFields(n.grid.Rows[0]);break;case 2:n.onSet(n.grid.Rows[0])}n.field.IsLookUpOpen=!1}else n.field.IsLookUpOpen=!0})};this.Close=function(){n.field.IsLookUpOpen=!1};this.GetWidth=function(){return n.getWidth?n.getWidth():n.elem.width()};this.GetName=function(){return n.tMenu.Name};n.field.OnLookUpOpen=function(t){t&&n.LoadData().then(function(){u.OnLookupOpen()})};this.SetFilter=function(t){n.grid.filter=[{Name:"Name",Value:[t],Type:1}]};this.ClearFilter=function(){n.grid.filter=null};this.ResetModel=function(){n.row[n.field.Name.trim().substr(3)]=null;n.row[n.field.Name]=null};this.Refresh=function(){n.grid.filter=null;n.LoadData()}}]}});n.directive("lookUpInput",["$rootScope","$controller",function(n,t){return{restrict:"A",require:["^lookUp","ngModel"],link:function(n,i,r,u){t("BaseController",{$scope:n});i.bind("keydown",function(t){switch(t.keyCode){case 9:t.preventDefault();n.IsNull(u[1].$viewValue,"")!==""?(u[0].SetFilter(u[1].$viewValue),u[0].Open()):u[0].ClearFilter()}});i.change(function(){n.IsNull(u[1].$viewValue,"")===""?(u[0].ClearFilter(),u[0].ResetModel()):(u[0].SetFilter(u[1].$viewValue),u[0].Open())})}}}]);n.directive("lookUpDiv",["$rootScope",function(){return{restrict:"E",require:"^^lookUp",templateUrl:"/Web/Template/look-up.tmpl.html",replace:!0,link:function(n,t,i,r){n.Init=function(){n.Width=r.GetWidth()};r.OnLookupOpen=function(){n.Width=r.GetWidth()};r.InitGrid=function(i,u){n.lookupName=r.GetName();r.hot=new Handsontable(t.find("#lookUpGrid")[0],{data:[],rowHeaders:!1,width:r.GetWidth(),height:300,autoWrapRow:!0,colHeaders:i,columns:u,onSelection:function(){this.deselectCell()}})};n.CloseLookUp=function(){r.Close()};n.Refresh=function(){r.Refresh()};var u=function(){r.Init()}(n,r)}}}]);n.directive("lazyLoadImage",["DataService",function(n){return{restrict:"A",scope:{lazyLoadImage:"="},link:function(t,i){t.$watch("lazyLoadImage.Image",function(){if(i.css({"background-image":"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA)","background-repeat":"no-repeat","background-position":"center"}),!t.lazyLoadImage.Image){i.css({"background-image":"url('/noimage.png')","background-size":"initial"});return}n.Post("LoadImage",{ImgFile:t.lazyLoadImage.Image,Container:t.lazyLoadImage.Container||null,Path:t.lazyLoadImage.Path||null,Size:t.lazyLoadImage.Size||null}).then(function(n){var t=setTimeout(function(){if(clearTimeout(t),n){i.css({"background-image":"url("+n+")","background-size":"contain"});var r=setTimeout(function(){clearTimeout(r)},1e3)}else i.css({"background-image":"url('/noimage.png')","background-size":"contain"})})}).fail(function(){i.css({"background-image":"url('/noimage.png')","background-size":"initial"})})})}}}]);n.directive("listMenu",["$controller","DataService","$compile","$Invoker",function(n,t,i,r){return{restrict:"E",scope:{tab:"="},replace:!0,templateUrl:"/Web/Template/list-menu.tmpl.html",link:function(u,f){n("BaseController",{$scope:u});u.grid={Skip:1,Take:30,Where:null};u.fltrText=null;u.ShowFilter=!1;u.FilterColumns=[];u.checkList={};var e=u.Request("MenuGridColumns",{ID_User:u.Session("ID_User"),ID_Menu:u.tab.ID_ListMenu}),o=t.GetMenu(u.tab.ID_ListMenu);$.when(e,o).then(function(n,t){var r,e,o;u.Columns=n[0].length===0?u.DefaultColumns():n[0];for(r in t)u[r]=t[r];e=[""];o=[{data:"ID",readOnly:!1,renderer:function(n,t,r,f,e,o){var s=i('<input type="checkbox" ng-model="checkList['+o+']" />')(u);return $(t).empty(),t.appendChild(s[0]),t.style.textAlign="center",t}}];Enumerable.From(u.Columns).ForEach(function(n){e.push(n.EffectiveLabel);o.push({data:n.Name,readOnly:!0});var t=n.Name;(n.ID_SystemControlType===2||n.ID_SystemControlType==4)&&(t=t.substr(3));u.FilterColumns.push(t)});u.hot=new Handsontable(f.find("#listMenuGrid")[0],{data:[],rowHeaders:!1,width:f.width(),height:f.height()-100,colHeaders:e,columns:o,onSelection:function(){this.deselectCell()}})});u.tab.OnLookUpOpen=function(n){n&&u.LoadData()};u.tab.OnLookUpKeyUp=function(n){n.keyCode===13&&(u.tab.IsLookUpOpen=!0)};u.Filter=function(){u.ShowFilter=!u.ShowFilter};u.fltrClick=function(n){n.keyCode===13&&u.LoadData()};u.Refresh=function(){u.ShowFilter=!1;u.fltrText=null;u.grid.Skip=1;u.LoadData()};u.LoadData=function(n){var t=u.PassParameter(u.tMenu.DataSource);return t=u.SetFromSystemQueryParameter(t),u.grid.Rows=[],u.grid.TotalItems=0,u.IsDataLoading=!0,u.grid.Where=u.ShowFilter?u.fltrText?{"*":u.fltrText}:null:u.lookUpName?{Name:u.lookUpName}:null,u.Request("LoadList",{DataSource:t,Skip:n?n.Skip||u.grid.Skip:u.grid.Skip,Where:u.grid.Where||null,TableName:u.tMenu.TableName,FilterColumns:u.FilterColumns}).then(function(t){u.IsDataLoading=!1;t.rows.length===0?(u.grid.Rows=[],u.grid.TotalItems=0):(u.grid.Rows=t.rows,u.grid.TotalItems=t.count);u.hot.loadData(t.rows);u.grid.Skip=n?n.Skip||u.grid.Skip:u.grid.Skip})};u.OnPageChanged=function(n){u.LoadData({Skip:n})};u.OpenItem=function(){var n=[],t;Object.keys(u.checkList).forEach(function(t){u.checkList[t]===!0&&n.push(parseFloat(t))});t=Enumerable.From(u.grid.Rows).Join(n,"$.ID","$",function(n){return n}).ToArray();u.checkList={};u.tab.IsLookUpOpen=!1;u.grid={Skip:1,Take:30,Where:null};u.fltrText=null;u.ShowFilter=!1;u.FilterColumns=[];r.invoke("ListMenuSelection",u.tab.ID,t)}}}}]);n.directive("dateToIso",function(){return{restrict:"A",require:"ngModel",scope:{ngModel:"="},link:function(n,t,i,r){t.on("blur",function(){if(n.ngModel!=""){var t;function i(n){var t=n;return Date.parse(t)}t=i(n.ngModel);r.$setViewValue(vcl.DateTime.Format(t,vcl.DateTime.masks.mediumDate));r.$render()}});n.$watch(function(){return r.$modelValue},function(n){n&&vcl.DateTime.IsNewtonFormat(n)&&(r.$setViewValue(vcl.DateTime.Format(n,vcl.DateTime.masks.mediumDate)),r.$render())})}}});n.directive("timeToIso",function(){return{restrict:"A",require:"ngModel",scope:{ngModel:"="},link:function(n,t,i,r){t.on("keydown",function(){return!1});n.$watch(function(){return r.$modelValue},function(n){n&&vcl.DateTime.IsNewtonFormat(n)&&(r.$setViewValue(vcl.DateTime.Format(n,vcl.DateTime.masks.shortTime)),r.$render())})}}});n.directive("ngRecursiveMenu",["$compile",function(n){return{restrict:"A",replace:!0,transclude:!0,scope:{menus:"=",itemSelect:"=",itemToggleFav:"=",menuContext:"="},templateUrl:"/Web/Template/ngRecursiveMenu.html",compile:function(t,i,r){var f=t.contents().remove(),u;return function(t,i){u||(u=n(f,r));u(t,function(n){i.append(n)});t.SetIcon=function(n){var t="",i;for(n=n.split(" "),i=0;i<n.length;i++)t+=n[i].substr(0,1);return t.length>2&&(t=t.substr(0,2)),t.toLowerCase()};t.SetSlide=function(n){var i=$("#"+n),r=$("span",i),f=$(i).width(),u=$("span",i).width();f<u&&(i.addClass("text-slide"),r.css("marginLeft",(u+5)*-1),$(r).bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){t.DeSetSlide()}))};t.DeSetSlide=function(){$(".ISAzureMenu_nav_wrap ul a p").removeClass("text-slide");$(".ISAzureMenu_nav_wrap ul a p span").css("marginLeft",0)}}}}}]);n.directive("ngRecursiveMenu2",["$compile",function(n){return{restrict:"A",replace:!0,scope:{menus:"=",itemSelect:"=",itemToggleFav:"=",menuContext:"="},templateUrl:"/Web/Template/ngRecursiveMenu2.html",link:function(t){t.SetIcon=function(n){var t="",i;for(n=n.split(" "),i=0;i<n.length;i++)t+=n[i].substr(0,1);return t.length>2&&(t=t.substr(0,2)),t.toLowerCase()};t.SetSlide=function(n){var i=$("#"+n),r=$("span",i),f=$(i).width(),u=$("span",i).width();f<u&&(i.addClass("text-slide"),r.css("marginLeft",(u+5)*-1),$(r).bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){t.DeSetSlide()}))};t.DeSetSlide=function(){$(".ISAzureMenu_nav_wrap ul a p").removeClass("text-slide");$(".ISAzureMenu_nav_wrap ul a p span").css("marginLeft",0);$(".covering_levels ul a p").removeClass("text-slide");$(".covering_levels ul a p span").css("marginLeft",0);$(".menu-cover ul a p").removeClass("text-slide");$(".menu-cover ul a p span").css("marginLeft",0)};t.openMenu=function(i){var r,u;if(i.Children.length==0)return!1;r=$("<nav/>");r[0].id="menu-cover_"+i.Parent.ID;r.addClass("menu-cover");u=$("<button/>");u.append("Back");u.addClass("menu-back");u[0].style.cursor="pointer";r.append(u);u.on("click",function(){$("#menu-cover_"+i.Parent.ID).removeClass("open-cover")});t.m=i;$("#menu-cover_"+i.Parent.ID).length==0?($(".menu-items").append(r),$("#menu-cover_"+i.Parent.ID).append(n('<div ng-recursive-menu2 menus="m.Children" item-select="itemSelect" item-toggle-fav="itemToggleFav" menu-context="menuContext"><div ng-transclude><\/div><\/div>')(t)),setTimeout(function(){r.addClass("open-cover")},100)):$("#menu-cover_"+i.Parent.ID).addClass("open-cover")}}}}]);n.directive("ngRecursiveMenu3",["$compile",function(){return{restrict:"A",replace:!0,scope:{menus:"=",itemSelect:"=",itemToggleFav:"=",menuContext:"="},templateUrl:"/Web/Template/ngRecursiveMenu3.html",link:function(n,t,i){n.SetIcon=function(n){var t="",i;for(n=n.split(" "),i=0;i<n.length;i++)t+=n[i].substr(0,1);return t.length>2&&(t=t.substr(0,2)),t.toLowerCase()};n.SetSlide=function(t){var i=$("#"+t),r=$("span",i),f=$(i).width(),u=$("span",i).width();f<u&&(i.addClass("text-slide"),r.css("marginLeft",(u+5)*-1),$(r).bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){n.DeSetSlide()}))};n.DeSetSlide=function(){$(".ISAzureMenu_nav_wrap ul a p").removeClass("text-slide");$(".ISAzureMenu_nav_wrap ul a p span").css("marginLeft",0);$(".covering_levels ul a p").removeClass("text-slide");$(".covering_levels ul a p span").css("marginLeft",0);$(".menu-cover ul a p").removeClass("text-slide");$(".menu-cover ul a p span").css("marginLeft",0)};n.idx=parseInt(i.idx)+1;n.openMenu=function(n,t,i){var r,i;$(t.currentTarget).find("i").removeClass("fa-chevron-right");$(t.currentTarget).find("i").addClass("fa-chevron-down");r=$(".child_"+n.Parent.ID);r.hasClass("hide-cover")?(i==1&&($(".menu-items").children().children().children().children().each(function(){$(t.currentTarget).attr("id")!=$($(this).children()[0]).attr("id")&&$(this).children().find("i").length>0&&$(this).children().find("i").hasClass("fa-chevron-down")&&($(this).children().find("i").removeClass("fa-chevron-down"),$(this).children().find("i").addClass("fa-chevron-right"))}),$(".menu-parent-ul").each(function(){var n=$(this);n.hasClass("hide-cover")||(n.addClass("hide-cover"),n.children().each(function(){var n=$(this);n.children().find("i").length>0&&n.children().find("i").hasClass("fa-chevron-down")&&(n.children().find("i").removeClass("fa-chevron-down"),n.children().find("i").addClass("fa-chevron-right"))}))})),$(".child_"+n.Parent.ID).removeClass("hide-cover"),i=parseInt($(".child_"+n.Parent.ID).attr("idx")),$(".child_"+n.Parent.ID).each(function(){var n=$(this);n[0].style.marginLeft=(i>1?i*15-10:i*15)+"px"})):(i==1&&($(".menu-items").children().children().children().children().each(function(){$(t.currentTarget).attr("id")!=$($(this).children()[0]).attr("id")&&$(this).children().find("i").length>0&&$(this).children().find("i").hasClass("fa-chevron-down")&&($(this).children().find("i").removeClass("fa-chevron-down"),$(this).children().find("i").addClass("fa-chevron-right"))}),$(".menu-parent-ul").each(function(){var n=$(this);n.hasClass("hide-cover")||(n.addClass("hide-cover"),n.children().each(function(){var n=$(this);n.children().find("i").length>0&&n.children().find("i").hasClass("fa-chevron-down")&&(n.children().find("i").removeClass("fa-chevron-down"),n.children().find("i").addClass("fa-chevron-right"))}))})),$(t.currentTarget).find("i").addClass("fa-chevron-right"),$(t.currentTarget).find("i").removeClass("fa-chevron-down"),$(".child_"+n.Parent.ID).addClass("hide-cover"),$(".child_"+n.Parent.ID).each(function(){var n=$(this);n[0].style.marginLeft=""}))}}}}]);n.directive("ngEnter",function(){return{restrict:"A",link:function(n,t,i){t.bind("keydown keypress",function(t){t.which===13&&(n.$apply(function(){n.$eval(i.ngEnter)}),t.preventDefault())})}}});n.directive("ngUpdateModel",function(){return{restrict:"A",scope:{ngUpdateModel:"=",ngModel:"="},require:"ngModel",link:function(n,t){t.bind("keyup keypress change blur",function(){n.ngUpdateModel.model[n.ngUpdateModel.name]=n.ngModel;n.$apply()})}}});n.directive("controlFilter",["$rootScope","$controller","$Invoker",function(n,t,i){return{restrict:"A",scope:{controlFilter:"=",onFilter:"=",idx:"="},templateUrl:"/Web/Template/Control-Filter.tmpl.html",link:function(n){var r,u;t("BaseController",{$scope:n});n.data={};n.dropdownSource={};n.nFltr=null;n.Init=function(){n.nFltr=[];n.controlFilter.length>0&&n.controlFilter.sort(function(n,t){return n.SeqNo-t.SeqNo});n.HasUserColumn=Enumerable.From(n.controlFilter).Where(function(n){return n.ID>0}).ToArray().length>0?!0:!1;n.controlFilter.forEach(function(t){t.CType=n.ValidateTextBoxControl(t)||2;n.nFltr.push(t)});n.nFltr.length>0&&n.nFltr.sort(function(n,t){return n.SeqNo-t.SeqNo})};r=Enumerable.From(n.controlFilter).Where(function(n){return n.ID_SystemControlType==2}).ToArray();n.Request("fetchFilterSource",{comboData:JSON.stringify(r)}).then(function(t){n.dropdownSource=t.data.dropdown_source});n.ValidateTextBoxControl=function(n){return n.ID_SystemControlType==1&&n.DataType=="int"?1:n.ID_SystemControlType==1&&(n.DataType=="varchar"||n.DataType=="decimal"||n.DataType=="text")?2:n.ID_SystemControlType===2?9:n.ID_SystemControlType===3?10:n.ID_SystemControlType===4?11:n.ID_SystemControlType==11&&n.DataType=="datetime"&&(n.Name.toLowerCase().indexOf("start")>-1||n.Name.toLowerCase().indexOf("end")>-1)&&n.Name.toLowerCase().indexOf("date")>-1?n.Name.toLowerCase().indexOf("start")>-1?12:13:n.ID_SystemControlType==11&&(n.DataType=="datetime"||n.Name.toLowerCase().indexOf("date")>-1)?8:n.ID_SystemControlType==12&&n.DataType=="datetime"&&(n.Name.toLowerCase().indexOf("start")>-1||n.Name.toLowerCase().indexOf("end")>-1)&&n.Name.toLowerCase().indexOf("time")>-1?n.Name.toLowerCase().indexOf("start")>-1?14:15:n.ID_SystemControlType==12&&n.DataType=="datetime"&&n.Name.toLowerCase().indexOf("time")>-1?4:n.ID_SystemControlType==17&&n.DataType=="datetime"&&(n.Name.toLowerCase().indexOf("start")>-1||n.Name.toLowerCase().indexOf("end")>-1)&&n.Name.toLowerCase().indexOf("datetime")>-1||n.ID_SystemControlType==17&&n.DataType=="datetime"&&n.Name.toLowerCase().indexOf("datetime")>-1?3:void 0};n.ExecuteFilter=function(){var t=[];n.nFltr.forEach(function(i){switch(i.CType){case 1:case 4:case 6:case 8:if(n.data["From_"+i.Name]){var r=n.data["To_"+i.Name]||n.data["From_"+i.Name];t.push({Name:i.Name,Value:[n.data["From_"+i.Name],r],Type:3})}break;case 0:case 2:n.data[i.Name]&&t.push({Name:i.Name,Value:[n.data[i.Name]],Type:1});break;case 11:n.data[i.Name]&&t.push({Name:i.Name,Value:[n.data[i.Name]],Type:4});break;case 12:case 14:n.data[i.Name]&&t.push({Name:i.Name,Value:[n.data[i.Name]],Type:5});break;case 13:case 15:n.data[i.Name]&&t.push({Name:i.Name,Value:[n.data[i.Name]],Type:6});break;default:n.data[i.Name]&&t.push({Name:i.Name,Value:[n.data[i.Name]],Type:2})}});n.onFilter(t)};n.g=i.group(n.Session("GUID"));n.ReturnFilter=function(){var t=[];return n.nFltr.forEach(function(i){switch(i.CType){case 1:case 4:case 6:case 8:if(n.data["From_"+i.Name]){var r=n.data["To_"+i.Name]||n.data["From_"+i.Name];t.push({Name:i.Name,Value:[n.data["From_"+i.Name],r],Type:3})}break;case 0:case 2:n.data[i.Name]&&t.push({Name:i.Name,Value:[n.data[i.Name]],Type:1});break;case 11:n.data[i.Name]&&t.push({Name:i.Name,Value:[n.data[i.Name]],Type:4});break;case 12:case 14:n.data[i.Name]&&t.push({Name:i.Name,Value:[n.data[i.Name]],Type:5});break;case 13:case 15:n.data[i.Name]&&t.push({Name:i.Name,Value:[n.data[i.Name]],Type:6});break;default:n.data[i.Name]&&t.push({Name:i.Name,Value:[n.data[i.Name]],Type:2})}}),t.length==0?null:t};n.clearfilter=function(){n.data={}};n.g.on("RFilter",n.ReturnFilter);n.g.on("ClearFilter",n.clearfilter);u=function(){n.Init()}(n)}}}]);n.directive("scrollOnClick",function(){return{scope:{scrollOnClick:"=",scrollId:"@"},restrict:"A",link:function(n,t){t.on("click",function(){var i=$('[info-id="'+n.scrollId+'"]'),t=$("[scroll-area]",i),r=$("#"+n.scrollOnClick,i);t.animate({scrollTop:t.scrollTop()-t.offset().top+r.offset().top},"slow")})}}});n.directive("scrlOnClick",function(){return{scope:{scrlOnClick:"="},restrict:"A",link:function(n,t){t.on("click",function(){var t=$("[scrl-area]"),i=$("#"+n.scrlOnClick);t.animate({scrollTop:t.scrollTop()-t.offset().top+i.offset().top-5},"slow")})}}});n.directive("printDialog",["$controller",function(n){return{restrict:"A",scope:{printDialog:"="},link:function(t,i){n("BaseController",{$scope:t});i.on("click",function(){t.Dialog({template:"print-dialog.tmpl.html",controller:"PrintDialogController",size:"md"}).result.then(function(n){t.printDialog(n)})})}}}]);n.controller("LookupFilter",["$controller","$scope","$uibModalInstance","dData","DataService","$Invoker","$compile",function(n,t,i,r,u,f,e){n("BaseController",{$scope:t});t.idx=(r.idx==null?0:r.idx)+1;t.g=f.group(t.Session("GUID"));t.grid={Skip:1,Take:30,filter:null,Pages:[1],OrderBy:"ID DESC"};t.sortDirection="DESC";t.IsDataLoading=!0;t.FilterColumns=null;t.RowCollection=[];u.GetMenu(r.menuID).then(function(n){t.Menu=n;t.Init=function(){t.LoadGrid().then(function(){t.LoadData()})};t.LoadGrid=function(){return t.Request("MenuGridColumns",{ID_User:t.Session("ID_User"),ID_Menu:t.Menu.tMenu.ID}).then(function(n){t.grid.Columns=n.length===0?t.DefaultColumns():n;setTimeout(function(){$(".lookup_filter_body_"+t.idx).empty();angular.element($(".lookup_filter_body_"+t.idx).append(e('<div idx="idx" control-filter="grid.Columns" on-filter="ListFilter"><\/div>')(t)))},t);t.HasUserColumn=Enumerable.From(t.grid.Columns).Where(function(n){return n.ID>0}).ToArray().length>0?!0:!1;t.grid.Columns.sort(function(n,t){return n.SeqNo-t.SeqNo})})};t.LoadData=function(){var n=t.PassParameter(t.Menu.tMenu.DataSource);return n=t.SetFromSystemQueryParameter(n),t.grid.Rows=[],t.grid.TotalItems=0,t.IsDataLoading=!0,t.Request("LoadList",{DataSource:n,Skip:t.grid.Skip,Where:t.grid.filter,TableName:t.Menu.tMenu.TableName,Columns:"*",Take:t.grid.Take,OrderBy:t.grid.OrderBy,SearchAll:r.filterValue}).then(function(n){if(t.IsDataLoading=!1,n.rows.length===0?(t.grid.Rows=[],t.grid.TotalItems=0):(t.grid.Rows=n.rows,t.grid.TotalItems=n.count),t.grid.Pages=Enumerable.Range(1,Math.ceil(t.grid.TotalItems/t.grid.Take)).ToArray(),r.rowCol instanceof Array)angular.forEach(r.rowCol,function(n){var i=Enumerable.From(t.grid.Rows).Where(function(t){return t.ID==n}).ToArray()[0];i.IsChecked=!1});else{var i=Enumerable.From(t.grid.Rows).Where(function(n){return n.ID==r.rowCol}).ToArray()[0];i.IsChecked=!1}})};t.Init()});t.Cancel=function(){i.dismiss()};t.sortRecord=function(n,i){i.target.className=="fa fa-sort"?t.sortDirection="asc":i.target.className=="fa fa-sort-asc"?t.sortDirection="desc":i.target.className=="fa fa-sort-desc"&&(t.sortDirection="asc");t.grid.OrderBy=n+" "+t.sortDirection;t.LoadData();t.resetColumns()};t.sortIcon=function(n){n=n.toString().toLowerCase();t.grid.OrderBy=t.grid.OrderBy.toString().toLowerCase();t.sortDirection=t.sortDirection.toString().toLowerCase();var i=t.grid.OrderBy.split(" ");return i.indexOf(n)==-1?"fa fa-sort":i.indexOf(n)>-1&&t.sortDirection=="asc"?"fa fa-sort-asc":i.indexOf(n)>-1&&t.sortDirection=="desc"?"fa fa-sort-desc":void 0};t.checkChildren=function(n){var i=$("[targetid$=_"+n+"]").not("[targetid=parent_"+n+"]");i.each(function(){var i=$(this),u=$("[targetid^=parent_"+n+"]"),r;u.is(":checked")?(i.prop("checked",!0).change(),r="",i.attr("targetid").split("_").length>2?(r=i.attr("targetid").split("_")[i.attr("targetid").split("_").length-2],i.attr("targetid").split("_")[0]=="child"||t.checkChildren(r,n)):(r=i.attr("targetid").split("_")[1],i.attr("targetid").split("_")[0]=="child"||t.checkChildren(r,n))):(i=$(this),i.prop("checked",!1).change(),r="",i.attr("targetid").split("_").length>2?(r=i.attr("targetid").split("_")[i.attr("targetid").split("_").length-2],i.attr("targetid").split("_")[0]=="child"||t.checkChildren(r,n)):(r=i.attr("targetid").split("_")[1],i.attr("targetid").split("_")[0]=="child"||t.checkChildren(r,n)))})};t.retRowCollection=function(){t.RowCollection=Enumerable.From(t.grid.Rows).Where(function(n){return n.IsChecked}).ToArray();t.RowCollection.length!==0?(i.close(t.RowCollection),t.RowCollection=null):t.Toast("No record selected!","Lookup","warning")};t.TogglePanelFilter=function(){$(".lookup_filter_"+t.idx).toggleClass("show-box");$(".lookup_filter_"+t.idx).hasClass("show-box")?$(".lookup_filter_"+t.idx).css("display","block"):(t.grid.filter=null,$(".lookup_filter_"+t.idx).css("display","none"))};t.ListFilter=function(n){t.grid.filter=n;t.LoadData()}}]);n.directive("ngFilterLookup",["$controller","DataService",function(n){return{restrict:"A",scope:{menu:"=",ngModel:"=?",colValue:"=",idx:"=",lookUpSet:"="},link:function(t,i,r){n("BaseController",{$scope:t});t.LoadDialog=function(){var n=null;n=t.colValue!=undefined&&t.colValue.length!=0?t.Dialog({template:"Lookup.tmpl.html",controller:"LookupFilter",size:"lg",data:{menuID:t.menu,filterValue:t.ngModel||"",rowCol:t.colValue,idx:t.idx}}):t.Dialog({template:"Lookup.tmpl.html",controller:"LookupFilter",size:"lg",data:{menuID:t.menu,filterValue:t.ngModel||"",rowCol:t.colValue||[],idx:t.idx}});n.result.then(function(n){var i=[];if(n.length>0){let r=new Set(n);if(r.size==1)t.ngModel=n[0].Name,t.colValue=n[0].ID,t.lookUpSet&&t.lookUpSet(n);else if(r.size>1)t.ngModel="(Multiple Values)",angular.forEach(n,function(n){i.push(n.ID)}),t.colValue=i,t.lookUpSet&&t.lookUpSet(n);else return!1}else n.length==0?(t.colValue&&(t.colValue=null),t.$apply()):(t.ngModel=n.Name,t.colValue=n.ID,t.lookUpSet&&t.lookUpSet(n))})};i.on("keyup",function(n){var i=n.keyCode||n.which;(t.ngModel==""||t.ngModel==null||t.ngModel==undefined)&&(t.colValue=null,t.$apply())});i.on("keydown",function(n){return(n=n||window.event,n.ctrlKey&&n.keyCode===67)?!1:n.keyCode===9?(n.preventDefault(),t.IsNull(r.ngModel,"")!==""&&t.LoadDialog(),!1):t.IsNull(r.ngModel,"")!==""?!0:!0});i.parent().find("span").on("click",function(){t.LoadDialog()});r.lookupType&&r.lookupType=="button"&&i.bind("click",function(){t.LoadDialog()})}}}]);n.directive("ngNumericOnly",[function(){return{restrict:"A",scope:"=",link:function(n,t){t.bind("keydown",function(n){if(n.which!=8&&n.which!=0&&(n.which<48||n.which>57))return!1})}}}]);n.directive("ngCurrencyOnly",[function(){return{restrict:"A",scope:"=",link:function(n,t,i){var r=i.fixedDecimal;t.bind("change keydown keyup",function(n){return n.which!=8&&n.which!=0&&n.which!=190&&n.which!=110&&(n.which<48||n.which>57)?!1:(n.which==190||n.which==110)&&t.val().split(".").length-1>=1?!1:void 0});r!=undefined&&t.bind("blur",function(){t.val(parseFloat(t.val()).toFixed(r))})}}}]);n.directive("makeDatetimePicker",[function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){setTimeout(function(){$(function(){$("#"+i.id).datetimepicker({sideBySide:!1,debug:!1,format:i.datetimeformat}).on("dp.change",function(n){n.date._d!=undefined&&(r.$setViewValue(moment(n.date._d).format(i.datetimeformat)),r.$render())}).on("dp.show",function(){})})},200);var u=n.$watch(i.ngModel,function(){if(r.$viewValue!=null)try{if(vcl.DateTime.IsNewtonFormat(r.$viewValue)){var n=moment(r.$viewValue).format(i.datetimeformat);r.$setViewValue(n)}}catch(t){r.$setViewValue("")}finally{r.$render();u()}})}}}]);n.directive("inputAutosize",[function(){return{restrict:"A",link:function(n,t){setTimeout(function(){t.css("min-width",t.parentsUntil("td").width());t.autosizeInput()},1e3)}}}]);n.directive("allowVersion",["$controller",function(n){return{restrict:"A",scope:{allowVersion:"="},link:function(t,i){n("BaseController",{$scope:t});parseFloat(t.currentVersion)<parseFloat(allowVersion)&&i.remove()}}}]);t=function(){return{require:"ngModel",restrict:"A",scope:{textType:"=",decimalPlace:"=",dbDataType:"=",textFormat:"=",ngModel:"="},link:function(n,t,i,r){t.on("blur",function(){/^$/.test(t.val())&&(r.$setViewValue(null),r.$render())});if(n.dbDataType!=undefined)$(t).input({type:n.dbDataType=="int"?"number":n.dbDataType=="decimal"?"decimal":""});else if(n.textType!=undefined)if($(t).input({type:n.textType,format:n.textFormat}),n.textType=="date"){t.on("blur",function(){/\S/.test(t.val())&&(r.$setViewValue(vcl.DateTime.Format(t.val(),vcl.DateTime.masks.mediumDate)),r.$render())});n.$watch(function(){return r.$modelValue},function(n){n&&n!=""&&vcl.DateTime.IsNewtonFormat(n)&&(r.$setViewValue(vcl.DateTime.Format(n,vcl.DateTime.masks.mediumDate)),r.$render())})}else if(n.textType=="time"){t.on("blur",function(){r.$setViewValue(vcl.DateTime.Format((new Date).toDateString()+" "+t.val(),vcl.DateTime.masks.shortTime));r.$render()});n.$watch(function(){return r.$modelValue},function(n){n&&vcl.DateTime.IsNewtonFormat(n)&&(r.$setViewValue(vcl.DateTime.Format(n,vcl.DateTime.masks.shortTime)),r.$render())})}else if(n.textType=="datetime"){t.on("blur",function(){r.$setViewValue(moment(new Date(t.val())).format($s.textFormat));r.$render()});n.$watch(function(){return r.$modelValue},function(n){n&&vcl.DateTime.IsNewtonFormat(n)&&(r.$setViewValue(vcl.DateTime.Format(n,vcl.DateTime.masks.inSysDateTime)),r.$render())})}}}};n.directive("ngInput",[t]);n.directive("ngInjValidator",[function(){return{require:"ngModel",restrict:"A",link:function(n,t,i,r){t.on("blur",function(){/\{{2}|\}{2}|(<(\\?)\w+(\s*?)(\w*?)>)|--/gm.test(t.val())&&(r.$setViewValue(null),r.$render())})}}}]);i=function(n,t,i,r,u){i("BaseController",{$scope:n});n.currentValue=u.currentValue||[];n.lookupNextSeqNo=u.lookupNextSeqNo;n.showFilter=!1;n.closeFilter=function(){n.showFilter=!n.showFilter};for(var f in u.menu)n[f]=u.menu[f];n.close=function(){t.close("close")};n.grid={filter:null,OrderBy:n.tMenu.Sort==null?"ID DESC":n.tMenu.Sort};n.tableOptions={hasPaging:!0,pageView:[50,120,150],viewCount:50,pages:[],columns:[],columnSortName:n.grid.OrderBy.split(" ")[0],columnSortOrder:n.grid.OrderBy.split(" ").length==1?"asc":n.grid.OrderBy.split(" ")[1].toLowerCase(),multiSelect:u.tblOption.multiSelect,tableHeight:"calc(100vh - 200px)"};n.Init=function(){return n.Request("MenuGridColumns",{ID_User:n.Session("ID_User"),ID_Menu:n.tMenu.ID}).then(function(t){n.grid.Columns=t.length===0?n.DefaultColumns():t;for(var i=0;i<n.grid.Columns.length;i++)n.grid.Columns[i].DataType=Enumerable.From(n.tMenuTabField).Where(function(t){return t.Name==n.grid.Columns[i].Name}).ToArray().length>0?Enumerable.From(n.tMenuTabField).Where(function(t){return t.Name==n.grid.Columns[i].Name}).Select(function(n){return n.DataType}).ToArray()[0]:null})};n.$watch("grid.filter",function(t,i){JSON.stringify(t)!=JSON.stringify(i)&&n.LoadData()});n.Init().then(function(){n.LoadData()});n.LoadData=function(){var t=n.PassParameter(n.tMenu.DataSource);return t=n.SetFromSystemQueryParameter(t),n.grid.Rows=[],n.grid.TotalItems=0,n.Request("LoadList",{DataSource:t,Skip:n.tableOptions.selectedPage,Where:n.grid.filter,TableName:n.tMenu.TableName,FilterColumns:n.FilterColumns,Take:n.tableOptions.viewCount,OrderBy:n.tableOptions.columnSortName+" "+n.tableOptions.columnSortOrder}).then(function(t){var r,i,u;for(t.rows.length===0?(n.grid.Rows=[],n.grid.TotalItems=0):(n.grid.Rows=t.rows,n.grid.TotalItems=t.count,n.currentValue.constructor===Array&&angular.forEach(n.grid.Rows,function(t){var i=n.currentValue.indexOf(t.ID);i>-1&&(t.IsChecked=!0)})),n.generatePages(n.grid.TotalItems),n.tableOptions.tableData=n.grid.Rows.sort(n.tableOptions.sortData),n.tableOptions.columns=[],r=0;r<n.grid.Columns.length;r++)i=n.grid.Columns[r],u={Name:i.Name,Label:i.EffectiveLabel,type:i.ID_SystemControlType,SeqNo:i.IsFreeze?i.GroupSeqNo:i.SeqNo,IsFreeze:i.IsFreeze,ColProp:i},i.Name!="$$hashKey"&&n.tableOptions.columns.push(u)})};n.LookUpExtraFields=function(t){var i=Enumerable.From(u.parentFields).Where(function(n){return(n.ParentLookUp||"")===u.fld.Name}),f;i.Any()&&(f=Enumerable.From(i).Where(function(n){return n.ListColumn.startsWith("ID_")}).Select(function(n){return n.ListColumn.substr(3)}).ToArray(),n.Request("LookUpExtraFields",{Columns:i.Select(function(n){return n.ListColumn}).Union(f).ToArray().join(","),Tablename:"v"+u.fld.Name.substr(3),ID:t.ID}).then(function(n){i.ForEach(function(t){u.dRow[t.Name]=n[t.ListColumn];t.ListColumn.startsWith("ID_")&&(u.dRow[t.Name.substr(3)]=n[t.ListColumn.substr(3)])});r.$apply()}))};n.TogglePanelFilter=function(){n.showFilter=!n.showFilter};n.retRowCollection=function(){n.RowCollection=n.tableOptions.getRowSelected();t.close(n.RowCollection);n.RowCollection=null};n.ListFilter=function(t){n.grid.filter=t;n.LoadData()};n.generatePages=function(t){var r,i;for(n.tableOptions.pages=[],r=t/n.tableOptions.viewCount,r+=t%n.tableOptions.viewCount>-1?1:0,i=1;i<=r;i++)n.tableOptions.pages.push(i)};n.tableOptions.onViewChange=function(){n.tableOptions.selectedPage=1;n.LoadData()};n.tableOptions.onPageChange=function(){var t=n.PassParameter(n.tMenu.DataSource);t=n.SetFromSystemQueryParameter(t);n.IsDataLoading=!0;n.Request("LoadList",{DataSource:t,Skip:n.tableOptions.selectedPage,Where:n.grid.filter,TableName:n.tMenu.TableName,FilterColumns:n.FilterColumns,Take:n.tableOptions.viewCount,OrderBy:n.tableOptions.columnSortName+" "+n.tableOptions.columnSortOrder}).then(function(t){n.IsDataLoading=!1;t.rows.length===0?(n.grid.Rows=[],n.grid.TotalItems=0):(n.grid.Rows=t.rows,n.grid.TotalItems=t.count);n.tableOptions.tableData=n.grid.Rows})};n.tableOptions.onSortChange=function(t,i){n.tableOptions.columnSortName=t;n.tableOptions.columnSortOrder=i=="asc"?"desc":"asc";n.LoadData()};n.tableOptions.onRowDoubleClick=function(t){var i=Enumerable.From(n.grid.Rows).Where(function(n){return n.ID===t.ID}).SingleOrDefault();u.dRow[u.fld.Name.trim().substr(3)]=i.Name;u.dRow[u.fld.Name]=t.ID;u.isFilter||n.LookUpExtraFields(t);n.close("close")}};n.controller("lzyLookupCtrl",["$scope","$uibModalInstance","$controller","$rootScope","dialogData","$compile",i]);n.directive("lookupAutocomplete",["$controller","$rootScope","$timeout",function(n,t,i){return{restrict:"A",scope:{row:"=",fld:"=",required:"&?",inputId:"=",seqNo:"=",multiSelect:"=?",isFilter:"=?",returnFilter:"&?",parentFields:"=?"},templateUrl:"/Web/Template/lookup-autocomplete.tmpl.html",link:function(r){n("BaseController",{$scope:r});r.showLoading=!1;var u={};r.Request("GetMenu",{ID_Menu:r.fld.ID_Menu}).then(function(n){u=n;for(var t in n)r[t]=n[t]});r.multiSelect=r.multiSelect||!1;r.Required=r.required==undefined?function(){return!1}:r.required();r.isFilter=r.isFilter||!1;r.dataLookup=[];r.ShowLookup=!1;r.LookUpExtraFields=function(n){var i=Enumerable.From(r.parentFields).Where(function(n){return(n.ParentLookUp||"")===r.fld.Name}),u;i.Any()&&(u=Enumerable.From(i).Where(function(n){return n.ListColumn.startsWith("ID_")}).Select(function(n){return n.ListColumn.substr(3)}).ToArray(),r.Request("LookUpExtraFields",{Columns:i.Select(function(n){return n.ListColumn}).Union(u).ToArray().join(","),Tablename:"v"+r.fld.Name.substr(3),ID:n.ID}).then(function(n){i.ForEach(function(t){r.row[t.Name]=n[t.ListColumn];t.ListColumn.startsWith("ID_")&&(r.row[t.Name.substr(3)]=n[t.ListColumn.substr(3)])});t.$apply()}))};r.onRowSelect=function(n){r.row[r.fld.Name.trim().substr(3)]=n.Name;r.row[r.fld.Name]=n.ID;r.isFilter||r.LookUpExtraFields(n);r.ShowLookup=!1};r.thread=null;r.TimeoutReset=function(){i.cancel()};r.search=function(n){i.cancel(r.thread);r.thread=i(function(){if(n.target.value.length>=2){r.dataLookup=[];var t=r.PassParameter(r.tMenu.DataSource);t=r.SetFromSystemQueryParameter(t);r.showLoading=!0;r.Request("GetLookupAutocomplete",{ds:t,search:n.target.value},!0).then(function(n){r.dataLookup=Enumerable.From(n.Source).Select(function(n){return{ID:n.ID,Name:n.Name}}).ToArray();r.ShowLookup=!0;r.showLoading=!1})}else r.ShowLookup=!1,r.showLoading=!1},800)};i(function(){var t=$("#"+r.inputId),n=null;t.on("keyup",function(t){t.target.value.length==0&&n==9&&(r.row[r.fld.Name.trim().substr(3)]=null,r.row[r.fld.Name]=null,r.dataLookup=[],r.loadLookup());t.target.value.length==0&&n==13&&(r.row[r.fld.Name.trim().substr(3)]=null,r.row[r.fld.Name]=null,r.dataLookup=[]);t.target.value.length==0&&n==8?(r.row[r.fld.Name.trim().substr(3)]=null,r.row[r.fld.Name]=null,r.dataLookup=[]):n!=9&&n!=13&&r.search(t)});t.on("keydown",function(t){if(n=t.which,n==9)if(r.dataLookup.length==1&&r.ShowLookup==!0){r.onRowSelect(r.dataLookup[0]);console.log(r.dataLookup[0]);t.preventDefault()}else t.preventDefault()})},200);$(document).click(function(){r.ShowLookup=!1});r.loadLookup=function(){var n={fld:r.fld,dRow:r.row,menu:u,tblOption:{multiSelect:r.multiSelect},lookupNextSeqNo:r.seqNo+1,isFilter:r.isFilter,currentValue:r.row[r.fld.Name],parentFields:r.parentFields};r.Dialog({template:"lzy.lookup.tmpl.html",controller:"lzyLookupCtrl",size:"md",windowClass:"lzy-lookup-dlg",resolve:{dialogData:n}}).result.then(function(n){if(n!="close"&&r.isFilter){if(n.length>0)if(n.length==1)r.row[r.fld.Name.trim().substr(3)]=n[0].Name,r.row[r.fld.Name]=n[0].ID;else{r.row[r.fld.Name.trim().substr(3)]="(Multiple Values)";var t=[];angular.forEach(n,function(n){t.push(n.ID)});r.row[r.fld.Name]=t}else n.length==0&&(r.row[r.fld.Name.trim().substr(3)]=null,r.row[r.fld.Name]=null);r.returnFilter()}})};r.ExecuteFilter=function(){r.isFilter&&r.returnFilter()}}}}]);n.directive("systemFilter",["$controller",function(n){return{restrict:"A",scope:{systemFilter:"=",gridFilter:"=",showFilter:"="},templateUrl:"/Web/Template/systemFilter.tmpl.html",link:function(t){t.closeFilter=function(){t.showFilter=!t.showFilter};n("BaseController",{$scope:t});t.data={};t.lookupNextSeqNo=0;t.$watch("systemFilter",function(n,i){if(JSON.stringify(i)!=JSON.stringify(t.systemFilter)){var r=Enumerable.From(t.systemFilter).Where(function(n){return n.type==2}).Select(function(n){return n.ColProp}).ToArray();t.GetDropdownSource(r)}});t.GetDropdownSource=function(n){t.Request("fetchFilterSource",{comboData:JSON.stringify(n)}).then(function(n){t.dropdownSource=n.dropdown_source})};t.ReturnFilter=function(){var n=[];t.systemFilter.forEach(function(i){switch(i.type){case 1:case 11:case 12:case 17:if(i.type==1&&i.ColProp.DataType!="int")t.data[i.Name]!=undefined&&t.data[i.Name]!=""&&t.data[i.Name]!=null&&n.push({Name:i.Name,Value:[t.data[i.Name]],Type:1});else if(t.data["From_"+i.Name]!=undefined&&t.data["To_"+i.Name]!=undefined&&(t.data["From_"+i.Name]!=""||t.data["To_"+i.Name]!="")){var r=t.data["To_"+i.Name]||t.data["From_"+i.Name];n.push({Name:i.Name,Value:[t.data["From_"+i.Name]||t.data["To_"+i.Name],r],Type:3})}break;case 2:case 3:t.data[i.Name]&&n.push({Name:i.Name,Value:[t.data[i.Name]],Type:2});break;case 4:t.data[i.Name]&&n.push({Name:i.Name,Value:[t.data[i.Name]],Type:4})}});t.gridFilter=n}}}}]);n.directive("keyPressDetector",function(){var t=function n(t){function f(n,t){return n>>>t|n<<32-t}for(var s,tt,k,a=Math.pow,v=a(2,32),e="length",i,u,d="",o=[],g=t[e]*8,r=n.h=n.h||[],y=n.k=n.k||[],p=y[e],nt={},h=2;p<64;h++)if(!nt[h]){for(i=0;i<313;i+=h)nt[i]=h;r[p]=a(h,.5)*v|0;y[p++]=a(h,1/3)*v|0}for(t+="";t[e]%64-56;)t+="\x00";for(i=0;i<t[e];i++){if(u=t.charCodeAt(i),u>>8)return;o[i>>2]|=u<<(3-i)%4*8}for(o[o[e]]=g/v|0,o[o[e]]=g,u=0;u<o[e];){for(s=o.slice(u,u+=16),tt=r,r=r.slice(0,8),i=0;i<64;i++){var ut=i+u,w=s[i-15],b=s[i-2],c=r[0],l=r[4],it=r[7]+(f(l,6)^f(l,11)^f(l,25))+(l&r[5]^~l&r[6])+y[i]+(s[i]=i<16?s[i]:s[i-16]+(f(w,7)^f(w,18)^w>>>3)+s[i-7]+(f(b,17)^f(b,19)^b>>>10)|0),rt=(f(c,2)^f(c,13)^f(c,22))+(c&r[1]^c&r[2]^r[1]&r[2]);r=[it+rt|0].concat(r);r[4]=r[4]+it|0}for(i=0;i<8;i++)r[i]=r[i]+tt[i]|0}for(i=0;i<8;i++)for(u=3;u+1;u--)k=r[i]>>u*8&255,d+=(k<16?0:"")+k.toString(16);return d};return{restrict:"A",link:function(n){var r="e827eeebe30863c3368d58f7e59a4d51a706e726f34672b4c341a48be85c360d",i="";document.onkeypress=function(u){if(u.keyCode==13){var f=t(i);f==r&&n.tmp();i=""}else i=i+u.key}}}})});