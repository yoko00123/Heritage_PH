"use strict";define(["app"],function(n){var i=function(n,t,i){t("BaseController",{$scope:n});n.Controller="Login";n.data={Username:null,Password:null,SelectCompanyAfterValidation:!1};n.Companies=[];n.UserData=null;n.InitCompanies=function(){try{n.Request("Companies").then(function(t){n.Companies=t.tCompany;n.UserData=t})}catch(t){n.LogOut()}};n.SelectCompany=function(t){n.Request("StartSession",{ID:n.UserData.ID,ID_Employee:n.UserData.ID_User,ID_Company:t.ID===0?null:t.ID,GUID:n.UserData.GUID}).then(function(t){i.UserRow(t);window.sessionStorage.setItem("ActiveApplicationType",t.ID_ApplicationType==null?1:t.ID_ApplicationType);vcl.Cookie("X-UID",null,-1);setTimeout(function(){n.ActionUrl("Index","Home")},1e3)})};n.Validating=!1;n.ValidationTrials=0;n.CaptchaValue=null;n.CaptchaInput=null;n.SignIn=function(){if(!n.Validating){if(n.CaptchaValue==null){if(n.ValidationTrials>=2){vcl.Cookie("Captcha",1);n.GenerateCaptcha();return}vcl.Cookie("Captcha",null,-1)}else{if(n.CaptchaInput!=n.CaptchaValue){n.GenerateCaptcha();return}n.CaptchaInput=n.CaptchaValue=null;n.ValidationTrials=0}n.Validating=!0;n.Request("AuthUser",n.data).then(function(t,i){n.Validating=!1;n.ValidationTrials=0;switch(i){case 4:n.ActionUrl("Companies","Account");break;case 3:n.Dialog({template:"FirstLog.tmpl.html",size:"md",controller:"changePassword",data:{IsFirstLog:!1,d:t}}).result.then(function(){});break;case 2:n.Dialog({template:"FirstLog.tmpl.html",size:"md",controller:"changePassword",data:{IsFirstLog:!0,d:t}}).result.then(function(){});break;default:n.UserData=t;n.SelectCompany({ID:t.ID_Company})}}).catch(function(){n.Validating=!1;n.ValidationTrials++})}};n.GenerateCaptcha=function(){n.CaptchaInput=null;n.Request("Captcha").then(function(t){n.CaptchaValue=t.Value;$("captcha").css({"background-image":"url("+t.Image+")","background-repeat":"no-repeat","background-position":"center"})})};n.LogOut=function(){i.Clear();setTimeout(function(){n.ActionUrl("LogOut","Account")},1e3)};n.SetIcon=function(n){var t="",i;for(n=n.split(" "),i=0;i<n.length;i++)t+=n[i].substr(0,1);return t.length>2&&(t=t.substr(0,2)),t.toLowerCase()};n.SetSlide=function(t){var i=$("#ml_"+t),r=$("span",i),f=$(i).width(),u=$("span",i).width();f<u&&(i.addClass("text-slide"),r.css("marginLeft",(u+5)*-1),$(r).bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){n.DeSetSlide()}))};n.DeSetSlide=function(){$(".company-ul li div p").removeClass("text-slide");$(".company-ul li div p span").css("marginLeft",0)}},t;n.controller("AccountComponent",["$scope","$controller","Session","$rootScope",i]);t=function(n,t,i,r){t("BaseController",{$scope:n});n.Master={};n.Master.ID_SecurityQuestion=null;n.Master.SecurityAnswer=null;n.cList=[];n.IsFirstLog=r.IsFirstLog;n.PasswordExpiration=null;var u=r.d;n.Request("FetchQuestions").then(function(t){n.cList=t.data});n.Request("GetPasswordExpiration").then(function(t){n.PasswordExpiration="Your password meets "+t+" days expiration, Please Change Your Password to log in"});n.typechange="password";n.typechange1="password";n.keyupchange=function(){n.typechange="password"};n.keydownchange=function(){n.typechange="text"};n.keyupchange1=function(){n.typechange1="password"};n.keydownchange1=function(){n.typechange1="text"};n.Cancel=function(){i.dismiss()};n.OK=function(){n.Master.password!==n.Master.password1?n.Toast("Must input the same password.","Set Password","warning"):n.Master.password==undefined||n.Master.password1==undefined||n.Master.password==null||n.Master.password1==null?n.Toast("Must input password","Set Password","warning"):n.IsFirstLog===!0&&(n.Master.ID_SecurityQuestion==undefined||n.Master.SecurityAnswer==undefined||n.Master.ID_SecurityQuestion==null||n.Master.SecurityAnswer==null||n.Master.ID_SecurityQuestion==""||n.Master.SecurityAnswer=="")?(console.log(n.IsFirstLog),n.Toast("Must input Security Question and Answer","Set Security Question","warning")):parseInt(u)!==1?n.Request("SetPassword",{password:n.Master.password,gUser:u,ID_User:u,IsFirstLog:n.IsFirstLog,question:n.Master.ID_SecurityQuestion,answer:n.Master.SecurityAnswer}).then(function(t,i){i==9?(n.Toast(t),n.Cancel()):n.Toast(t,"Set Password","warning")}):n.Toast("System Account cannot change password: Contact your system provider to resolve this issue")}};n.controller("changePassword",["$scope","$controller","$uibModalInstance","dData",t])});